/*! Copyright 2009-2017 Evernote Corporation. All rights reserved. */
!function(){function a(){}var b=2;a.prototype.invalidate=function(){var a=Persistent.get("googleConnection");a&&(a[account.userInfo.userId]=null),Persistent.set("googleConnection",a)},a.prototype.refresh=function(){var a=Persistent.get("googleConnection"),c=Persistent.get("userLastUpdated")||0;return account.reload().then(function(d){if(!a||!a[d.userId]||a[d.userId].version<b||Date.now()>=a[d.userId].expires||c>a[d.userId].lastQueried)return new Promise(function(a){extension.createUtilityClient().getOAuthCredential(d.authenticationToken,OAUTH_CREDENTIAL_SERVICE_GOOGLE_CONNECT,function(b){a({credential:b})},function(b){a({error:b})})})}).then(function(c){return account.isAuthenticated&&c&&(a=a||{},c.credential?(a[account.userInfo.userId]={lastQueried:Date.now(),connected:!0,expires:c.credential.expires,version:b},Persistent.set("googleConnection",a)):"EDAMNotFoundException"===c.error.__proto__.name&&"OAuthCredential"===c.error.identifier||"EDAMUserException"===c.error.__proto__.name&&c.error.code===EDAMErrorCode.DATA_CONFLICT?(a[account.userInfo.userId]={lastQueried:Date.now(),connected:!1,version:b},Persistent.set("googleConnection",a)):c.error&&log.error(c.error)),a?a[account.userInfo.userId]:null})},window.googleContactsManager=new a}();