/*! Copyright 2009-2017 Evernote Corporation. All rights reserved. */
reqC(["topFrame!checkSimSearch!"],function(a){function b(a){if(a){var b=document.createElement("link");b.type="text/css",b.rel="stylesheet",b.href=Browser.extension.getURL("css/"+a),document.head.appendChild(b)}}function c(a){if("string"==typeof a)return document.querySelector(a);for(var b=0;b<a.length;b++){var c=document.querySelector(a[b]);if(c)return c}return null}function d(){return c(u[a].insertBefore)}function e(a,b){a&&a.auth&&a.auth.username?(r=a.auth,i(!0)):i(!1)}function f(b,c){o=b.options,p=b.bootstrapInfo,q=o.secureProto+p.serviceHost,("Google"!=a||"Google"==a&&document.getElementById("ires"))&&g()}function g(){clearTimeout(s),s=setTimeout(function(){o.useSearchHelper&&t&&Browser.sendToExtension({name:"main_isAuthenticated",type:"simSearch"})},300)}function h(){var b=u[a].queryParam,c=document.querySelector("input[name='"+b+"']");return!(!c.value||""==c.value.trim())}function i(b){var e=document.getElementById("evernoteSimSearchResults");if((!e||e.getAttribute("extension")==Browser.extensionID)&&(n&&n.parentNode&&n.parentNode.removeChild(n),h()&&(!u[a].exclude||!c(u[a].exclude)))){n=document.createElement("iframe");var f="content/sim_search_results.html?locale="+p.name+"&baseUrl="+q;b&&(f+="&userId="+r.userId+"&shardId="+r.shardId),n.id="evernoteSimSearchResults",n.setAttribute("extension",Browser.extensionID);var g=d();g&&g.parentNode&&(g.parentNode.insertBefore(n,g),n.src=Browser.extension.getURL(f),l())}}function j(a){if(!a)return!1;var b=document.querySelector("link[href='"+Browser.extension.getURL("css/"+a)+"']");return!!b}function k(a,b,c){n.style.height=a.height+"px",0==a.height?(n.style.display="none",n.parentNode.removeChild(n)):n.style.display="block"}function l(){var a=document.getElementById("evernoteSimSearchResults"),b=document.getElementById("rhs");a&&b&&(a.style.width=Math.min(Math.max(window.innerWidth-b.offsetLeft-30,280),456)+"px")}function m(){t=!1}var n,o,p,q,r,s,t=!0,u={Baidu:{queryParam:"wd",insertBefore:[".c-container"]},Bing:{queryParam:"q",insertBefore:["#results","#b_results .b_algo"]},Daum:{css:"daumsearchhelper.css",queryParam:"q",insertBefore:["#splinkColl+div+hr+[id$='Coll']","#mArticle [id$='Coll']","#noResult"]},Google:{queryParam:"q",insertBefore:["#rhs_block"],exclude:["#map_slot"]},Naver:{queryParam:"query",insertBefore:[".section:not(.ad_power) > .section_head","#notfound p"]},Yahoo:{queryParam:"p",insertBefore:["#web"]},YahooJP:{queryParam:"p",insertBefore:["#WS2m","#WS2al p"]},Yandex:{css:"yandexrusearchhelper.css",queryParam:"text",insertBefore:[".serp-list"]}},v="searchhelper.css";b(v),b(u[a].css),setInterval(function(){j(v)||b(v),j(u[a].css)||b(u[a].css)},1e3),Browser.addMessageHandlers({simSearch_isAuthenticated:e,simSearch_sendHeight:k,temporarilyDisableSimSearch:m,config:f}),["Google","Bing","Baidu","Yandex"].indexOf(a)>-1?(document.addEventListener("animationstart",function(a){a&&"simSearch"===a.animationName&&g()}),"Google"==a&&window.addEventListener("resize",l)):window.addEventListener("hashchange",function(){g()}),Browser.sendToExtension({name:"main_getConfig",options:{secureProto:null,useSearchHelper:null},bootstrapInfo:{serviceHost:null,name:null}})});