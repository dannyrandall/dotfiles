"use strict";function sendRequest(e){if(null!=e)if(e.cmd&&"popupfillinputget"!=e.cmd&&"popupfilliconnumber"!=e.cmd&&L("IF -> BG : cmd="+e.cmd),g_ischrome)try{chrome_runtime_sendMessage(e,function(){})}catch(e){}else g_issafari?safari.self.tab?safari.self.tab.dispatchMessage(e.cmd,e):safari.extension&&safari.extension.globalPage&&safari.extension.globalPage.contentWindow&&safari.extension.globalPage.contentWindow.message_handler({name:e.cmd,message:e,target:window}):g_isfirefoxsdk?(e.messagetype=e.cmd,send_message(e)):g_iscasper&&"function"==typeof t_sendmsg&&t_sendmsg(e)}var g_reference_url="",InfieldIcons={globe:"/images/Globe.png",profile:"/images/Profile.png",other:"/images/Other.png",mastercard:"/images/Mastercard.png",visa:"/images/Visa.png",amex:"/images/Amex.png",discover:"/images/Discover.png"},InfieldCommands=function(){function e(e){csTop.LPInfieldFrame.close(e)}function n(e){sendRequest({cmd:"editaid",aid:e,fromiframe:1})}function t(n){sendRequest({cmd:"autofillaid",aid:n,from_iframe:!0,no_manualfill_on_saveall:!0,fromiframe:1,source:"formv2"}),e("action")}function i(e){sendRequest({cmd:"copyurl",aid:e,fromiframe:1})}function r(e){sendRequest({cmd:"copyusername",aid:e,fromiframe:1})}function o(e){sendRequest({cmd:"copypassword",aid:e,fromiframe:1,source:"formv2"})}function s(e,n){chrome_runtime_sendMessage({cmd:"popupfillsetgenerateprefs",prefstr:e,genpwstr:n})}function a(n){sendRequest({cmd:"editprofile",ffid:n,fromiframe:1,source:"formv2"}),e("action")}function c(n){sendRequest({cmd:"fillformffid",ffid:n,fromiframe:1,source:"formv2"}),e("action")}function l(e,n){sendRequest({cmd:"copytoclipboard",g_data:e,action:n,source:"formv2"})}function d(e){chrome_runtime_sendMessage({cmd:"popupfillgetgenerateprefs"},e)}function p(n,t){sendRequest({cmd:"fillgenpassword",password:n,saveOptions:t,nofill:1}),e("action")}function u(e,n,t){chrome_runtime_sendMessage({cmd:"searchvault",searchQuery:e,searchType:n},t)}function f(e){chrome_runtime_sendMessage({cmd:"getpopupfilldata"},e)}function m(e,n){sendRequest({cmd:"lpimprove",event:e,properties:n})}return{closePopup:e,copyToClipboard:l,editSite:n,fillUsernamePass:t,copyUrl:i,copyUserName:r,copyPassword:o,editFormFill:a,fillForm:c,getGeneratePrefs:d,writeAllPrefs:s,fillGeneratedPassword:p,searchVault:u,getInitialData:f,sendLPImprove:m}}();!function(e){var n=function(n,t,i){var r=this;r._onResizeCallback=i,n&&(n instanceof jQuery?r._triggerElement=n:r._triggerElement=e("#"+n),t?(r._triggerElement.click(function(e){r.show(),r._setPosition(e)}),r._triggerElement.keypress(function(n){r.show(),e(r._menuElement[0]).children().children()[0].focus(),r._setPosition(n)})):(r._triggerElement.children().click(function(e){r.show()}),r._triggerElement.children().keypress(function(n){r.show(),e(r._menuElement[0]).children().children()[0].focus()})))};n.prototype._setPosition=function(n){var t=e(n.currentTarget).offset();t.top+=20,t.left+=20,this._menuElement.offset(t)},n.prototype.show=function(){e(".dropdown").hide(),e(".menuTriggered").removeClass("menuTriggered");var n=this;n._triggerElement.closest(".tile").addClass("menuTriggered"),n._triggerElement.addClass("menuTriggered"),this._menuElement&&this._menuElement.show(0,function(){n._onResizeCallback&&n._onResizeCallback(n._menuElement.height(),90)})},n.prototype.hide=function(e){var n=this;n._triggerElement.closest(".tile").removeClass("menuTriggered"),n._triggerElement.removeClass("menuTriggered"),n._triggerElement.blur(),this._menuElement&&(this._menuElement.hide(e),n._onResizeCallback())},n.prototype.resetTimer=function(e){var n=this;n._menuElement&&(n._menuTimer=setTimeout(function(){n.hide()},e||1e3))},n.prototype.createMenu=function(n,t,i){var r=this;return r._menuElement=e("<div></div>").attr("id",n+"Menu").addClass("dropdown").addClass(t).hide().hover(function(){r._triggerElement.closest(".tile");clearTimeout(r._menuTimer)},function(){r.resetTimer(300)}).append(r._createMenuItems(i)),r._menuElement},n.prototype._createMenuItems=function(n){var t=this;t._menuItems=n;for(var i=e("<ul></ul>").addClass("menuList"),r=0;r<t._menuItems.length;r++){var o=e("<li></li>").attr("data-viewId",t._menuItems[r].id).attr("tabindex","1").click(function(e){t.hide(),t.select(e.currentTarget.getAttribute("data-viewId"),!0)}).focus(function(){clearTimeout(t._menuTimer)}).keypress(function(e){t.hide(),t.select(e.currentTarget.getAttribute("data-viewId"),!0)}).append(e("<p></p>").text(t._menuItems[r].text));i.append(o)}return i},n.prototype._findMenu=function(n){var t=e.grep(this._menuItems,function(e){return e.id===n});return t&&t.length>0?t[0]:null},n.prototype.select=function(e,n){var t=this._findMenu(e);t&&this._triggerElement&&this._triggerElement.find("p").text(t.selectedText),n===!0&&t&&t.action&&t.action()},window.InfieldMenu=n}(jQuery);var InfieldView=function(e){function n(e){Array.isArray(e)&&e.length>0&&(r=e,i())}function t(n){r.indexOf(n)!=-1&&(i(),e("#"+n).show())}function i(){e.each(r,function(n,t){e("#"+t).hide()})}var r=[];return{init:n,show:t}}(jQuery),InfieldGeneratePassword=function(e){function n(n,i,s){e("#moreOptions, #hideOptions").click(function(){o(),s&&s()}),e("#length").on("input",function(){InfieldSearch.debounce(r(),500)}),e(".pwgen").change(t),e("#generateBtn").click(t),e("#pronounceable").click(function(){e("#pronounceable").prop("checked")?(e("#digits").prop("checked",!1),e("#digits").prop("disabled",!0),e("#special").prop("checked",!1),e("#special").prop("disabled",!0),e("#ambig").prop("checked",!1),e("#upper").prop("checked",!0),e("#lower").prop("checked",!0)):(e("#digits").prop("checked",!0),e("#digits").prop("disabled",!1),e("#special").prop("checked",!0),e("#special").prop("disabled",!1))}),e("#ambig").click(function(){e("#ambig").prop("checked")&&(e("#pronounceable").prop("checked",!1),e("#digits").prop("disabled",!1),e("#special").prop("disabled",!1))}),e("#password").on("copy",function(){bg.LPTabState.setCopiedGeneratedPassword(this.value)}).LP_addGeneratePasswordMeter(),e("#btnCopy").click(function(){var t=e("#password").val();n.copyToClipboard(t,"generatepassword"),e("#btnCopy").hide(),e("#copied").show(),setTimeout(function(){e("#copied").hide(),e("#btnCopy").show()},1e3),bg.LPTabState.setCopiedGeneratedPassword(t)});var a=function(){n.fillGeneratedPassword(e("#password").val(),{pronounceable:e("#pronounceable").prop("checked"),length:e("#password").val().length,expand:e("#moreOptions").is(":hidden"),uppercase:e("#upper").prop("checked"),lowercase:e("#lower").prop("checked"),numeric:e("#digits").prop("checked"),special:e("#special").prop("checked"),avoidAmbiguous:e("#ambig").prop("checked"),source:"formv2"}),c[Object.keys(c).length]=e("#password").val(),n.writeAllPrefs(JSON.stringify({generate_pronounceable:e("#pronounceable").prop("checked")?1:0,generate_length:e("#length").val(),generate_upper:e("#upper").prop("checked")?1:0,generate_lower:e("#lower").prop("checked")?1:0,generate_digits:e("#digits").prop("checked")?1:0,generate_special:e("#special").prop("checked")?1:0,generate_ambig:e("#ambig").prop("checked")?1:0,generate_mindigits:2,generate_reqevery:0}),LPJSON.stringify(c))};e("#fillPasswordBtn").click(a),e("#generateAndFillBtn").click(a),e("#generateAndFillBtn").keypress(a),e("#advancedView").hide(),e("#generateBtnContainer").hide()}function t(){var n=lpCreatePass(e("#length").val(),e("#upper").prop("checked"),e("#lower").prop("checked"),e("#digits").prop("checked"),e("#special").prop("checked"),2,e("#ambig").prop("checked"),!0,e("#pronounceable").prop("checked"));e("#password").val(n).change()}function i(n){c=LPJSON.parse(n.genpwstr);var t=JSON.parse(n.prefstr);e("#length").val(parseInt(t.generate_length)),r(),e("#upper").prop("checked",!!parseInt(t.generate_upper)),e("#lower").prop("checked",!!parseInt(t.generate_lower)),e("#digits").prop("checked",!!parseInt(t.generate_digits)),e("#special").prop("checked",!!parseInt(t.generate_special)),e("#ambig").prop("checked",!!parseInt(t.generate_ambig)),e("#advancedView").hide(),e("#generateAndFillView").show(),parseInt(t.generate_pronounceable)?e("#pronounceable").click():e("#pronounceable").prop("pronounceable",!1),e("#password").val(lpCreatePass(e("#length").val(),e("#upper").prop("checked"),e("#lower").prop("checked"),e("#digits").prop("checked"),e("#special").prop("checked"),2,e("#ambig").prop("checked"),!0,e("#pronounceable").prop("checked"))).change()}function r(){e("#generatedPasswordLength").text(e("#length").val()),e("#sliderFill").width(e("#length").val()+"%")}function o(){e("#advancedView").toggle(),e("#generateAndFillView").toggle(),e("#generateBtnContainer").toggle(),e("#moreOptions").toggle()}function s(){e("#moreOptions").show(),e("#generateBtnContainer").hide()}function a(){e("#moreOptions").hide(),e("#generateBtnContainer").hide()}var c={};return{init:n,setup:i,show:s,hide:a}}(jQuery),InfieldTiles=function(e,n,t,i){function r(t,r,s,l,d,p){c=d;var u=[];if(e("#menuContainer").empty(),e("#"+t).empty().append(e('<p class="italic"></p>').text(p)),s){var f=e.map(s,function(e,n){return e});f.sort(function(e,n){return e}),e.each(f,function(e,t){var s=!1;e+1===f.length&&(s=!0);var c=a(r,{id:"sites"===r?t.aid:t.ffid,name:"sites"===r?t.name:t.decprofilename,description:"sites"===r?t.unencryptedUsername:1==t.profiletype?t.formattedCCNum:null,icons:o(l,r,t),moreText:"sites"===r?i.translateString("More"):i.translateString("Edit"),moreHandler:"sites"===r?null:function(){n.editFormFill(t.ffid)},clickHandler:"sites"===r?function(){n.fillUsernamePass(t.aid)}:function(){n.fillForm(t.ffid)},lastTile:s});c&&u.push(c)}),u.length>0&&e("#"+t).empty().append(u)}return u.length}function o(t,i,r){var o="",s="";if("formfills"===i)if(0==r.profiletype)o=InfieldIcons.profile;else switch(r.ccType){case"VISA":o=InfieldIcons.visa;break;case"AMEX":o=InfieldIcons.amex;break;case"MC":o=InfieldIcons.mastercard;break;case"DISC":o=InfieldIcons.discover;break;default:o=InfieldIcons.other}else s="icon-site",t&&r.aid&&t[r.aid]?o=t[r.aid]:(o=InfieldIcons.globe,n.sendLPImprove("iconnotfound",{domain:r.tld}));return{normalEl:e("<img/>").attr("src",o).addClass("icon-default "+s)}}function s(n){return e("<div></div>").addClass("col-2 no-left-gutter no-right-gutter").append(e("<div></div>").addClass("icon").append(n))}function a(i,r){if(!r)return null;var o=null,a=e("<div></div>").addClass("col-8 text full-height"),l=e("<button></button>").attr("id",r.id+"btn").attr("tabindex","1").text(r.moreText);switch(i){case"formfills":a.append(e("<span></span>").text(r.name)),r.description&&a.removeClass("full-height").append(e("<br/>")).append(e("<span></span>").addClass("small").text(r.description));break;case"sites":a.append(e("<span></span>").addClass("small").text(r.name)),r.description&&a.removeClass("full-height").append(e("<br/>")).append(e("<span></span>").text(r.description)),o=new t(l,!0,c),e("#menuContainer").append(o.createMenu(r.id+"btn","tileDropdown",[{id:"copyPassword",text:"Copy password",action:function(){n.copyPassword(r.id)}},{id:"copyUsername",text:"Copy username",action:function(){n.copyUserName(r.id)}},{id:"copyURL",text:"Copy URL",action:function(){n.copyUrl(r.id)}},{id:"editSite",text:"Edit",action:function(){n.editSite(r.id)}}]))}r.moreHandler&&l.click(r.moreHandler);var d=e("<div></div>").addClass("col-2 no-right-gutter no-left-gutter pull-right more").append(l),p=s([r.icons.normalEl]);p.click(r.clickHandler),a.click(r.clickHandler);var u=e("<div></div>").addClass("tile col-12").attr("id",r.id).attr("tabindex","1").append(e("<div></div>").addClass("row").append(p,a,d)).hover(function(){},function(){u.removeClass("triggered")});return r.lastTile&&u.addClass("lastTile"),l.focus(function(){u.addClass("triggered")}).blur(function(){u.removeClass("triggered")}).click(function(){u.addClass("menuTriggered"),u.removeClass("triggered")}),u}var c;return{setup:r}}(jQuery,InfieldCommands,InfieldMenu,Strings),InfieldSearch=function(e){function n(n){if(l=e("#searchContainer"),d=e("#currentTab"),p=e("#searchBtnContainer"),u=e("#inlineSearch"),f=e("#searchCloseBtn"),m=e("#searchBtn"),o(),e("#searchBtn").click(function(){i()}).keypress(function(){i()}),e("#searchCloseBtn").click(function(){r(),n("")}).keypress(function(){r(),n("")}),n){var s=t(function(t){n(e(t.currentTarget).val())},500);u.keyup(s)}}function t(e,n){var t;return function(){var i=this,r=arguments;clearTimeout(t),t=setTimeout(function(){t=null,e.apply(i,r)},n)}}function i(){d.fadeOut(),l.show(),l.animate({width:"360px"},250,function(){f.show(),u.fadeIn().focus()}),m.addClass("searchBtnActive")}function r(){u.val(""),u.hide(),f.fadeOut(),l.show(),l.animate({width:"16px"},250,function(){p.fadeOut(),d.fadeIn()}),m.removeClass("searchBtnActive")}function o(){u.hide(),f.hide(),l.show().css({width:"16px"}),p.hide(),d.show(),m.removeClass("searchBtnActive")}function s(){l.show()}function a(){u.hide(),p.hide(),f.hide(),l.hide()}function c(e){e&&e===!0?s():a()}var l,d,p,u,f,m;return{init:n,debounce:t,showIcon:s,hideIcon:a,display:c}}(jQuery),lpInfield=function(e,n,t,i,r,o,s,a,c){function l(){document.addEventListener("DOMContentLoaded",function(){m(function(){c.translate(document.body),d(),f(),i.init(["sitesView","formFillView","generatePassView"]),u(),o.init(g),s.init(n,b,w),new MutationObserver(function(){w()}).observe(e(".infield-dialog")[0],{subtree:!0,childList:!0}),n.getInitialData(v),e("#currentTabText").focus()})})}function d(){k=new a({$parentEl:e(".infield-dialog")}),p({position:360})}function p(n){k&&n&&n.position&&e.isNumeric(n.position)&&n.position>10&&n.position<370&&k.show("top",n.position)}function u(){b=new t("currentTab",null,w);var n=b.createMenu("navigation",null,[{id:"sitesView",text:c.translateString("Log inlower"),selectedText:c.translateString("Log in as"),action:function(){_.start_type="sites",v(_)}},{id:"formFillView",text:c.translateString("Fill form"),selectedText:c.translateString("Fill form with"),action:function(){_.start_type="formfills",v(_)}},{id:"generatePassView",text:c.translateString("Generate password"),selectedText:c.translateString("Generate password"),action:function(){_.start_type="generate",v(_)}}]);e("#navigationPlaceholder").append(n)}function f(){e("#btnClose").click(function(){n.closePopup("close")}),e("#btnClose").keypress(function(){n.closePopup("close")})}function m(e){var n=document.createElement("iframe");n.setAttribute("class","backgroundFrame"),n.src="backgroundFrame.html",n.style.display="none",n.addEventListener("load",function(){n.contentWindow.LPPlatform.getBackgroundInterface({mainRequestFramework:!1,interfaceDefinition:Interfaces.InfieldPopupInterface,context:"infieldPopup",callback:function(n){window.bg=n,e&&e()}}),n.contentWindow.Topics.get(n.contentWindow.Topics.REQUEST_FRAMEWORK_INITIALIZED).subscribe(function(e,n){var t=parseInt(e.topFrameID);window.csTop=Interfaces.createInstance(Interfaces.ContentScriptInterface,{direct:!1,context:"infieldPopup",requestFunction:function(e){n.sendRequest({type:"contentScriptRequest",data:e,frameID:t})}}),window.csTop.LPFrame.initializeRequestFramework(LPTools.getURLParams().dialogID)})}),document.body.appendChild(n)}function g(e){n.searchVault(e,_.start_type,h)}function h(e){var n=_.start_type;if(e){var t=JSON.parse(e);if(t)switch(n){case"sites":r.setup("sitesView",n,t.sites,t.bigicons,w,I);break;case"formfills":r.setup("formFillView",n,t.formfills,null,w,P)}}}function w(n,t){var i=e(".infield-dialog").outerHeight()+20,r=e(".infield-dialog").outerWidth()+10;n&&e.isNumeric(n)&&(i+=n),t&&e.isNumeric(t)&&(r+=t),csTop.LPInfieldFrame.resizeFrame(i,r)}function v(t){if(!t)return void n.closePopup("close");if(_=t,t.start_type)switch(t.start_type){case"sites":if(t.sites){var a=JSON.parse(t.sites),c=t.bigicons?JSON.parse(t.bigicons):null,l=r.setup("sitesView",t.start_type,a,c,w,y);b.select("sitesView"),i.show("sitesView"),o.display(l>2),s.hide()}break;case"formfills":if(t.formfills){var d=JSON.parse(t.formfills),l=r.setup("formFillView",t.start_type,d,null,w,C);b.select("formFillView"),i.show("formFillView"),o.display(l>2),s.hide()}break;case"generate":n.getGeneratePrefs(s.setup),b.select("generatePassView"),i.show("generatePassView"),o.display(!1),s.show()}csTop.LPInfieldFrame.positionFrame(),csTop.LPInfieldFrame.show(),e(".infield-dialog").show()}var b,_,k,y=c.translateString("No sites found for this web address. You can log in to this website to save your credentials"),I=c.translateString("No sites found matching your search."),C=c.translateString("No Form Fills saved. You can add one in your Vault."),P=c.translateString("No Form Fills found matching your search.");return{init:l,setArrowPosition:p}}(jQuery,InfieldCommands,InfieldMenu,InfieldView,InfieldTiles,InfieldSearch,InfieldGeneratePassword,lpArrow,Strings);lpInfield&&lpInfield.init();