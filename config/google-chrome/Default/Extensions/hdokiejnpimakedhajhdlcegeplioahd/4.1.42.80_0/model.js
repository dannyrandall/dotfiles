"function"!=typeof Object.create&&(Object.create=function(t){function e(){}return e.prototype=t,new e}),function(){var t=function(t,e){if(this._data=t||{},this._sharedGroup=e,e){var a=this.getTopLevelGroupName();e.getName()!==a&&(this._data.group=e.getName()+this._data.group.substring(a.length))}else!this.useSharePrefix()&&this._data.group&&0===this._data.group.indexOf(this.SHARED_FOLDER_NAME_PREFIX)&&(this._data.group=this._data.group.substring(this.SHARED_FOLDER_NAME_PREFIX.length))};VaultItemBase=function(e,a){this._views=[],t.apply(this,arguments)},VaultItemBase.prototype.refresh=function(e,a){return t.apply(this,arguments),this}}(),VaultItemBase.prototype.defaultFields=function(t,e){e=e||this._data;for(var a in t)void 0===e[a]&&(e[a]=t[a])},VaultItemBase.prototype.SHARED_FOLDER_NAME_PREFIX="Shared-",VaultItemBase.prototype.useSharePrefix=function(){return!!this.getSharedGroup()&&this._sharedGroup.useSharePrefix()},VaultItemBase.prototype.getTopLevelGroupName=function(){var t=this._data.group||"",e=t.indexOf("\\");return e>-1?t.substring(0,e):t},VaultItemBase.prototype.getSource=function(){return"vault"},VaultItem=function(){var t={pwprotect:!1};return function(e,a){VaultItemBase.call(this,e,a),this.defaultFields(t)}}(),VaultItem.prototype=Object.create(VaultItemBase.prototype),VaultItem.prototype.constructor=VaultItem,AccountBase=function(){var t={action:"",aid:"0",basic_auth:"0",captcha_id:"",custom_js:"",extra:"",fields:[],group:"",fiid:"",getpw:!1,individualshare:!1,last_touch:"0",method:"",newvalues:[],realm_data:"",sharedfromuid:"",submit_id:"",urid:"0",fav:"0",username:"",password:""};return function(e,a){VaultItem.call(this,e,a),this.defaultFields(t)}}(),AccountBase.prototype=Object.create(VaultItem.prototype),AccountBase.prototype.constructor=AccountBase,AccountBaseWithFields=function(t,e){AccountBase.call(this,t,e)},AccountBaseWithFields.prototype=Object.create(AccountBase.prototype),AccountBaseWithFields.prototype.constructor=AccountBaseWithFields,Account=function(t,e){AccountBaseWithFields.call(this,t,e),this._data.sn=0},Account.prototype=Object.create(AccountBaseWithFields.prototype),Account.prototype.constructor=Account,Account.prototype.getDisplayClass=function(){return AccountDisplay},Account.prototype.TYPE="Account",Group=function(t,e){AccountBase.call(this,t,e),this._data.url="http://group"},Group.prototype=Object.create(AccountBase.prototype),Group.prototype.constructor=Group,Group.prototype.getDisplayClass=function(){return GroupDisplay},DummyGroup=function(t,e){Group.call(this,{group:t},e)},DummyGroup.prototype=Object.create(Group.prototype),DummyGroup.prototype.constructor=DummyGroup,DummyGroup.prototype.getDisplayClass=function(){return DummyGroupDisplay},DefaultGroup=function(t){DummyGroup.call(this,t)},DefaultGroup.prototype=Object.create(DummyGroup.prototype),DefaultGroup.prototype.constructor=DefaultGroup,DefaultGroup.prototype.getDisplayClass=function(){return DefaultGroupDisplay},function(){var t={accepted:"1",association:"0",associative:"0",can_administer:"1",cgid:"0",deleted:"0",download:"1",give:"1",id:"0",invisible:"0",outside_enterprise:"0",readonly:"0",shareid:"0"},e=function(e,a){this.useSharePrefix()&&0!==this._data.group.indexOf(this.SHARED_FOLDER_NAME_PREFIX)&&(this._data.group=this.SHARED_FOLDER_NAME_PREFIX+this._data.group),this._data.group=this.getTopLevelGroupName(),a=a||{};var r=LPTools.get_gmt_timestamp();t.create=r,t.last_modified=r,this.defaultFields(t,a),this._shareInfo=a,this._shareInfo.name=this.getShareGroupName(),this._shareInfo.decsharename=this._data.group,this.setID(this._data.aid)};SharedGroup=function(t,a){Group.call(this,t),e.apply(this,arguments)},SharedGroup.prototype=Object.create(Group.prototype),SharedGroup.prototype.constructor=SharedGroup,SharedGroup.prototype.refresh=function(t,a){return Group.prototype.refresh.call(this,t),e.apply(this,arguments),this}}(),SharedGroup.prototype.getDisplayClass=function(){return SharedGroupDisplay},LinkedGroup=function(t,e){SharedGroup.call(this,t,e)},LinkedGroup.prototype=Object.create(SharedGroup.prototype),LinkedGroup.prototype.constructor=LinkedGroup,LinkedGroup.prototype.getDisplayClass=function(){return LinkedGroupDisplay},EmergencyAccessGroup=function(t,e){LinkedGroup.call(this,t,e)},EmergencyAccessGroup.prototype=Object.create(LinkedGroup.prototype),EmergencyAccessGroup.prototype.constructor=EmergencyAccessGroup,EmergencyAccessGroup.prototype.getDisplayClass=function(){return EmergencyAccessGroupDisplay},function(){var t=function(t,e,a){this._data.sn=1,this._data.url="http://sn",this._attachments=a||[];for(var r=0,o=this._attachments.length;r<o;++r)this._attachments[r].setParentNote(this)};Note=function(e,a,r){AccountBase.call(this,e,a),t.apply(this,arguments)},Note.prototype=Object.create(AccountBase.prototype),Note.prototype.constructor=Note,Note.prototype.refresh=function(e,a,r){return AccountBase.prototype.refresh.apply(this,arguments),t.apply(this,arguments),this}}(),Note.prototype.getDisplayClass=function(){return NoteDisplay},Note.prototype.TYPE="Note",FormFill=function(){var t={address1:"",address2:"",address3:"",bankacctnum:"",bankname:"",bankroutingnum:"",birthday:"",cccsc:"",ccexp:"",ccissuenum:"",ccname:"",ccnum:"",ccstart:"",city:"",company:"",country:"",country_cc3l:"",country_name:"",county:"",creditmon:"",customfield1alttext:"",customfield1cfid:"0",customfield1text:"",customfield1value:"",customfield2alttext:"",customfield2cfid:"0",customfield2text:"",customfield2value:"",customfield3alttext:"",customfield3cfid:"0",customfield3text:"",customfield3value:"",deleteext:0,driverlicensenum:"",email:"",eveext:"",evephone:"",evephone3lcc:"",fax:"",fax3lcc:"",faxext:"",ffid:0,firstname:"",firstname2:"",firstname3:"",gender:"",group:"",lastname:"",lastname2:"",lastname3:"",middlename:"",mobileemail:"",mobileext:"",mobilephone:"",mobilephone3lcc:"",notes:"",phone:"",phone3lcc:"",phoneext:"",profilelanguage:"",profilename:"",profiletype:0,ssn:"",state:"",state_name:"",taxid:"",timezone:"",title:"",username:"",zip:""};return function(e,a){VaultItem.call(this,e,a),this.defaultFields(t),void 0===this._data.decprofilename&&(this._data.decprofilename=LPProxy.decryptMobile(this._data.profilename,!0,this.getKey()))}}(),FormFill.prototype=Object.create(VaultItem.prototype),FormFill.prototype.constructor=FormFill,FormFill.prototype.getDisplayClass=function(){return FormFillDisplay},FormFill.prototype.TYPE="FormFill",Attachment=function(t){VaultItemBase.call(this,t),this._filename=null},Attachment.prototype=Object.create(VaultItemBase.prototype),Attachment.prototype.constructor=Attachment,Attachment.prototype.getDisplayClass=function(){return AttachmentDisplay},Identity=function(t){VaultItemBase.call(this,t),this.defaultFields({iid:"0"}),this._enabled=!1,void 0===this._data.deciname&&(this._data.deciname=LPProxy.decrypt(this._data.iname,this.getKey()))},Identity.prototype=Object.create(VaultItemBase.prototype),Identity.prototype.constructor=Identity,Identity.prototype.getDisplayClass=function(){return IdentityDisplay},AllIdentity=function(){Identity.call(this),this._data.deciname="All",this._data.iid=""},AllIdentity.prototype=Object.create(Identity.prototype),AllIdentity.prototype.constructor=AllIdentity,AllIdentity.prototype.getDisplayClass=function(){return AllIdentityDisplay},Application=function(){var t={appaid:"0"};return function(e,a){AccountBaseWithFields.call(this,e,a),this.defaultFields(t),this.setSaveAll()}}(),Application.prototype=Object.create(AccountBaseWithFields.prototype),Application.prototype.constructor=AccountBaseWithFields,Application.prototype.getDisplayClass=function(){return ApplicationDisplay},Application.prototype.TYPE="Application",function(t,e,a,r){var o="Are you sure you want to delete %1?";!function(){var e=function(t,e,a){return t>e?a?1:-1:t<e?a?-1:1:0};VaultItemBase.prototype.sortByFunction=function(t,a,r,o){return e(t[r].apply(t),a[r].apply(a),o)},VaultItemBase.prototype.sortByTextFunction=function(){var t=function(t,e){var a=t[e].apply(t);return"string"==typeof a?a.toLowerCase():""};return function(a,r,o,n){return e(t(a,o),t(r,o),n)}}(),VaultItemBase.prototype.sortByNameAsc=function(t,e){return VaultItemBase.prototype.sortByTextFunction(t,e,"getName",!0)},VaultItemBase.prototype.sortByNameDesc=function(t,e){return VaultItemBase.prototype.sortByTextFunction(t,e,"getName",!1)},VaultItemBase.prototype.lockForUpdate=function(){for(var t=0,e=this._views.length;t<e;++t)this._views[t].lockForUpdate()},VaultItemBase.prototype.unlock=function(){for(var t=0,e=this._views.length;t<e;++t)this._views[t].unlock()},VaultItemBase.prototype.updateViews=function(t,e){for(var a=this._views.slice(),r=0,o=a.length;r<o;++r)a[r].updateView(t,e)},VaultItemBase.prototype.destroyViews=function(){for(var t=this._views.slice(),e=0,a=t.length;e<a;++e)t[e].destruct();this._views=[]},VaultItemBase.prototype.newDisplayObject=function(){return new(this.getDisplayClass())(this)},VaultItemBase.prototype.addView=function(t){this._views.push(t)},VaultItemBase.prototype.removeView=function(t){for(var e=0,a=this._views.length;e<a;++e)if(this._views[e]===t){this._views.splice(e,1);break}},VaultItemBase.prototype.isNew=function(){return"0"===this.getID()},VaultItemBase.prototype.createHandler=function(t){var e=this;if(arguments.length>1){for(var a=[],r=1,o=arguments.length;r<o;++r)a.push(arguments[r]);return function(){t.apply(e,a)}}return function(){t.apply(e,arguments)}},VaultItemBase.prototype.update=function(t,e,o){if(r.removeItem(this),t&&(this._data=t),r.addItem(this),this._sharedGroup=e?e.getSharedGroup():null,a.getOption(o,"updateViews",!0)){var n=null;if(Array.isArray(this._views)){var s=this._views[0];n=s&&s._parent?s._parent._model:null}if(this.updateViews(e,o),bg.get("g_nofolder_feature_enabled")&&n&&n._data&&n._views){var i=n._data.group===Strings.Vault.NONE_GROUP||n._data.group===Strings.Consts.NONE_GROUP,p=0===n._views.length;i&&p&&r.removeItem(n)}}},VaultItemBase.prototype.deleteUpdates=function(t){(void 0===t||t)&&this.publishSuccess(Strings.Vault.DELETED);var e=Array.isArray(this._views)&&this._views[0]&&this._views[0]._parent?this._views[0]._parent._model:null;if(this.destroyViews(),r.removeItem(this),bg.get("g_nofolder_feature_enabled")&&e&&e._data&&e._views){var a=e._data.group===Strings.Vault.NONE_GROUP||e._data.group===Strings.Consts.NONE_GROUP,o=0===e._views.length;a&&o&&r.removeItem(e)}},VaultItemBase.prototype.getRepromptType=function(){return null},VaultItemBase.prototype.publishAdd=function(t,e,a){r.addItem(this),this.publishSuccess(Strings.Vault.ADDED),Topics.get(t).publish(this,e,a)},VaultItemBase.prototype.getSuccessMessage=function(){return function(t,e){return e>1?Strings.translateString("%1 items were %2.",e,t):Strings.translateString("%1 was %2.",this.toString(),t)}}(),VaultItemBase.prototype.publishSuccess=function(t,e){Topics.get(Topics.SUCCESS).publish(this.getSuccessMessage(t,e))},VaultItemBase.prototype.handleClickEvent=function(t,e){switch(t){case Constants.ACTION_EDIT:this.edit(e);break;case Constants.ACTION_DELETE:this.deleteItem(e);break;case Constants.ACTION_PURGE:this.purge(e);break;case Constants.ACTION_RESTORE:this.restore(e);break;case Constants.ACTION_MOVE_TO_FOLDER:this.moveToFolder(e.group,e.itemsForAction,e)}},VaultItemBase.prototype.isShared=function(){var t=this.getSharedGroup();return t&&!(t instanceof LinkedGroup)},VaultItemBase.prototype.shouldPasswordProtectShare=function(){return!0},VaultItemBase.prototype.passwordProtect=function(t,e){for(var r=a.getOption(e,"itemsForAction",[this]),o=!1,n={},s=0,i=r.length;s<i;++s){var p=r[s];if(p.passwordProtected()){o=!0;break}p.shouldPasswordProtectShare()&&p.isShared()&&(n.switch_f_prompt=!0)}e=e||{},o?delete e.types:e.types=a.getProperties(n).concat(a.getOption(e,"types",[])),this.reprompt(t,e)},VaultItemBase.prototype.reprompt=function(t,e){return r.reprompt(this.createHandler(function(){t.apply(this)}),e)};var n=function(t,e){for(var a,r=t.itemsForAction,o=0,n=r.length;o<n;++o){var s=r[o];if(void 0===a)a=s.getShareID();else if(a!==s.getShareID())return void Topics.get(Topics.ERROR).publish(Strings.translateString("Sorry, you cannot perform this operation on a mix of shared and non-shared folders, or multiple shared folders at once."))}e(t,a)};VaultItemBase.prototype.purge=function(){var t=function(t){return t.length>1?Strings.translateString(Strings.VaultDynamic.CONFIRM_PURGE,this instanceof Group?Strings.Vault.FOLDER_PURGE:Strings.Vault.SELECTED_PURGE):Strings.translateString(Strings.VaultDynamic.CONFIRM_PURGE,t[0].toString())},e=function(e,a){var o=e.itemsForAction;LPRequest.makeUpdateRequest(r.purgeDeletedItems,{parameters:[o,a],success:function(){for(var t=0,e=o.length;t<e;t++)o[t].deleteUpdates(!1);o[0].publishSuccess(Strings.Vault.PURGED,o.length)},confirm:{title:Strings.Vault.PURGE,text:t.call(this,o)}})};return function(t){n(t,e)}}(),VaultItemBase.prototype.restore=function(){var t=function(t){return t.length>1?Strings.translateString(Strings.VaultDynamic.CONFIRM_RESTORE,this instanceof Group?Strings.Vault.FOLDER_PURGE:Strings.Vault.SELECTED_PURGE):Strings.translateString(Strings.VaultDynamic.CONFIRM_RESTORE,t[0].toString())},e=function(e,a){var o=e.itemsForAction;LPRequest.makeRequest(r.restoreDeletedItems,{parameters:[o,a],success:function(){for(var t=0,e=o.length;t<e;t++)o[t].deleteUpdates(!1);o[0].publishSuccess(Strings.Vault.RESTORED,o.length),r.refreshSites()},confirm:{title:Strings.Vault.RESTORE,text:t.call(this,o)}})};return function(t){n(t,e)}}(),VaultItemBase.prototype.confirmDelete=function(t){return t&&t.length>1?{title:Strings.Vault.DELETE,text:Strings.translateString(o,Strings.translateString("the selected items"))}:function(t){return{title:Strings.Vault.DELETE,text:Strings.translateString(o,t.toString())}}(this)},VaultItemBase.prototype.isDeleted=function(){return"1"===this._data.deleted},VaultItemBase.prototype.getName=function(){var t=this._data.name;return t?t:""},VaultItemBase.prototype.getURL=function(){return this._data.url},VaultItemBase.prototype.isFavorite=function(){return"1"===this._data.fav},VaultItemBase.prototype.setFavorite=function(t){this._data.fav=t?"1":"0"},VaultItemBase.prototype.processEnteredData=function(t,e,a){for(var r in t){var o=this._data[r];"boolean"!=typeof t[r]||"0"!==o&&"1"!==o||(t[r]=t[r]?"1":"0")}e&&e.getSharedGroup()?t.sharefolderid=e.getShareID():delete t.sharefolderid},VaultItemBase.prototype.saveFromDialog=function(e,a,r){var o=a?a.getKey():this.getKey();this.processEnteredData(e,a,o,r),e=t.extend({},this._data,e),this.save(e,a,r),this.noFolderTrackingEvent(e.group)},VaultItemBase.prototype.addFromDialog=function(e,a,r){var o=a?a.getKey():this.getKey();this.processEnteredData(e,a,o,r),t.extend(this._data,e),this.add(a,r),this.noFolderTrackingEvent(e.group)},VaultItemBase.prototype.getFormData=function(t){var e={};for(var a in t){var r="pwprotect"===a||"autologin"===a||"never_autofill"===a||"fav"===a,o=this._data[a];r&&"1"===o?e[a]=!0:r&&"0"===o?e[a]=!1:void 0!==o&&"object"!=typeof o&&(e[a]=o)}return e},VaultItemBase.prototype.getKey=function(){var t=this.getSharedGroup();return t?t.getKey():r.getLocalKey()},VaultItemBase.prototype.getShareID=function(){var t=this.getSharedGroup();return t?t.getID():this._data.sharefolderid||""},VaultItemBase.prototype.isReadOnly=function(){var t=this.getSharedGroup();return!!t&&t.isReadOnly()},VaultItemBase.prototype.getShareInfo=function(){var t=this.getSharedGroup();return t?t._shareInfo:null},VaultItemBase.prototype.getSharedGroup=function(){return this._sharedGroup?this._sharedGroup:null},VaultItemBase.prototype.getURLArguments=function(e,a,r){return t.param(this.getPostData(e,a,r))},VaultItemBase.prototype.getGroupName=function(){return this._data.group},VaultItemBase.prototype.getGroupParentName=function(){var t=this._data.group,e=t.lastIndexOf("\\");return e>0?t.substring(0,e):""},VaultItemBase.prototype.getSearchTokens=function(t){return[this.getName()]},VaultItemBase.prototype.getPostData=function(t,e,a){var r={};return r.extjs=1,r.localupdate=1,r.ajax=1,a&&(a.source&&(r.source=a.source),a.folder&&(r.folder=a.folder)),r},VaultItemBase.prototype.passwordProtected=function(){return this.getRepromptType()&&bg.get("g_prompts")[this.getRepromptType()]},VaultItemBase.prototype.getLastTouch=function(){return 0},VaultItemBase.prototype.edit=function(t){Topics.get(this.getEditTopicID()).publish({vaultItem:this,dialogActions:t.dialogActions})},VaultItemBase.prototype.encryptIfNecessary=function(t,e,a){var o=this.getKey();return r.decryptMobile(this._data[t],!0,o)!==e||a!==o?r.encryptMobile(e,!0,a):this._data[t]},VaultItemBase.prototype.noFolderTrackingEvent=function(t){if(t&&"(none)"!==t){for(var e=r.getGroups(),a=!1,o=!1,n=0,s=e.length;n<s;++n){switch(e[n].getName()){case t:a=!0;break;case"(none)":o=!0}}a||bg.sendLpImprove("no_folder::user_folder_created",{folder:t,foldercount:o?e.length:e.length+1,nofolderfeatureenabled:bg.get("g_nofolder_feature_enabled")})}}}(),function(){VaultItem.prototype.handleClickEvent=function(t,e){switch(t){case Constants.ACTION_SHARE:this.share(e);break;default:VaultItemBase.prototype.handleClickEvent.apply(this,arguments)}},VaultItem.prototype.share=function(t){this.passwordProtect(function(){Topics.get(Topics.ITEM_SHARE).publish(t.itemsForAction)},t)},VaultItem.prototype.deleteItem=function(t){for(var e,o=t&&t.itemsForAction||[this],n=0,s=o.length;n<s;++n){var i=o[n];if(i.isReadOnly())return void Topics.get(Topics.ERROR).publish(Strings.translateString("You do not have permission to %1 %2",Strings.translateString("delete items from"),i.getSharedGroup().toString()));if(void 0===e)e=i.getSharedGroup();else if(e!==i.getSharedGroup())return void Topics.get(Topics.ERROR).publish(Strings.translateString("Sorry, you cannot perform this operation on a mix of shared and non-shared folders, or multiple shared folders at once."))}this.passwordProtect(function(){LPRequest.makeLockItemUpdateRequest(r.deleteItem,{parameters:[o],items:o,success:function(){o[0].publishSuccess(Strings.Vault.DELETED,o.length);for(var e=0,a=o.length;e<a;++e)o[e].deleteUpdates(!1);t.success&&t.success()},confirm:a.getOption(t,"confirm",!0)?o[0].confirmDelete(o):null})},t)},function(){VaultItem.prototype.moveToFolderPostCheck=function(t,s,i,p){if(t.length>0||s.length>0){var u=a.getOption(p,"saveFromDialog",!1),c=function(){var a=t.concat(s);LPRequest.makeLockItemUpdateRequest(r.moveToFolder,{parameters:[a,i],items:a,success:function(r){if(e(t,r,i,p),o(r,i,p),!u){var n=i.toString(),s="moved to ";bg.get("g_nofolder_feature_enabled")&&(s="organized to ",n!==Strings.Vault.GROUP+" "+Strings.Vault.NONE_GROUP&&n!==Strings.Vault.GROUP+" "+Strings.Consts.NONE_GROUP||(n=Strings.Vault.NO_FOLDER)),a[0].publishSuccess(s+n,a.length)}p&&p.success&&p.success()},confirm:n(t,i)})};u?c():this.passwordProtect(c,{itemsForAction:t.concat(s)})}},Group.prototype.moveToFolderPostCheck=function(a,s,i,p){var u=t.extend(!0,{},this._data);u.group=i.getName()+"\\"+this.getGroupName(),function(s){LPRequest.makeUpdateRequest(r.renameGroup,{parameters:[s,u],success:function(r){e([s],r,i,p),e(a,r,i,t.extend(p,{updateViews:!1})),o(r,i,p),s.publishSuccess("moved to "+i.toString())},confirm:n(a,i)})}(this)};var e=function(t,e,a,r){for(var o=0,n=t.length;o<n;++o){var s=t[o],i=s.getID();e&&e[i]?(s.update(e[i],a,r),delete e[i]):s.update(s._data,a,r)}},o=function(t,e,a){for(var r in t){var o=t[r];o.sn?new Note(o,e.getSharedGroup()).publishAdd(Topics.NOTE_ADDED,e,a):o.appaid?new Application(o,e.getSharedGroup()).publishAdd(Topics.SITE_ADDED,e,a):new Account(o,e.getSharedGroup()).publishAdd(Topics.SITE_ADDED,e,a)}},n=function(t,e){for(var a=null,r=!1,o=!1,n=!1,s=e?e.getSharedGroup():null,i=0,p=t.length;i<p;++i){var u=t[i],c=u.getSharedGroup();c?s?c!==s&&(r=!0):c instanceof LinkedGroup||(n=!0):!s||s instanceof LinkedGroup||(o=!0)}if(r||o||n){var l=[];r&&l.push(Strings.translateString("You are moving items to a different shared folder. This may change who has access to them.")),o&&l.push(Strings.translateString("You are moving sites to a shared folder. Others may now have access to them.")),n&&l.push(Strings.translateString("You are moving items from a shared folder into your vault. Others may lose access to them.")),l.push(Strings.translateString("Do you want to continue?")),a={title:Strings.translateString("Shared Folders"),text:l}}return a};AccountBase.prototype.saveFromDialog=function(t,e){var a=n([this],e);if(a){for(var r=[VaultItem.prototype.saveFromDialog],o=0,s=arguments.length;o<s;++o)r.push(arguments[o]);a.handler=this.createHandler.apply(this,r),Topics.get(Topics.CONFIRM).publish(a)}else VaultItem.prototype.saveFromDialog.apply(this,arguments)},VaultItem.prototype.moveToFolder=function(t,e,r){if(t.isReadOnly())Topics.get(Topics.ERROR).publish(Strings.translateString("You do not have permission to %1 %2",Strings.translateString("move items to"),t.toString()));else{for(var o=[],n=[],s=[],i=[],p=t.getSharedGroup(),u=0,c=e.length;u<c;++u){var l=e[u];l.isReadOnly()?s.push(l):p&&l._data.individualshare?parseInt(l._data.sharedfromaid)>0?n.push(l):o.push(l):i.push(l)}var d=[];n.length>0&&d.push({type:"alert",title:Strings.translateString("Error"),text:[Strings.translateString("The following items have been individually shared with you and cannot be moved into a shared folder:"),a.buildDialogItemContainer(n)]}),s.length>0&&d.push({type:"alert",title:Strings.translateString("Error"),text:[Strings.translateString("You do not have permission to move the following items from their respective shared folders:"),a.buildDialogItemContainer(s)]}),o.length>0&&d.push({type:"confirmation",title:Strings.translateString("Error"),text:[Strings.translateString("The following items have already been shared individually and cannot be moved to a shared folder:"),Strings.translateString("Would you like to make a copy?"),a.buildDialogItemContainer(o)],closeHandler:function(){o.splice(0,o.length)}}),d.length>0?a.openAlerts(d,function(e){return function(){e.moveToFolderPostCheck.call(e,i,o,t,r)}}(this)):this.moveToFolderPostCheck.call(this,i,o,t,r)}}}(),VaultItem.prototype.passwordProtected=function(){return this._data.pwprotect||VaultItemBase.prototype.passwordProtected.apply(this,arguments)},VaultItem.prototype.getPostData=function(t,e){var a=VaultItemBase.prototype.getPostData.apply(this,arguments);return t.pwprotect&&(a.pwprotect="on"),a}}(),function(){AccountBase.prototype.getLastTouch=function(){return parseInt(this._data.last_touch)},AccountBase.prototype.getID=function(){return this._data.aid},AccountBase.prototype.setID=function(t){this._data.aid=t},AccountBase.prototype.getFormData=function(t){var e=VaultItem.prototype.getFormData.apply(this,arguments);return e.extra=r.decryptMobile(this._data.extra,!0,this.getKey()),e},AccountBase.prototype.getPostData=function(t,e){var a=VaultItem.prototype.getPostData.apply(this,arguments),o=e?e.getKey():r.getLocalKey();a.aid=this.getID(),a.name=r.encryptWithKey(t.name,o),a.extra=r.encryptWithBTOA(t.extra);var n=e.getSharedGroup();return n?(a.sharedfolderid=n.getID(),a.grouping=r.encryptWithKey(t.group.substring(n.getName().length+1),o)):a.grouping=r.encryptWithKey(t.group,o),t.pwprotect&&(a.pwprotect="on"),"1"===t.fav&&(a.fav="on"),a},AccountBase.prototype.checkForSharedGroupChange=function(t){var e=this.getSharedGroup(),a=t.getSharedGroup();return(null!==e||null!==a)&&e!==a},AccountBase.prototype.handleClickEvent=function(t,e){switch(t){case Constants.ACTION_COPY_USERNAME:this.copyUsername();break;case Constants.ACTION_COPY_PASSWORD:this.copyPassword(e);break;case Constants.ACTION_CLONE:this.cloneItem();break;default:VaultItem.prototype.handleClickEvent.apply(this,arguments)}},AccountBase.prototype.getSearchTokens=function(t){var e=VaultItem.prototype.getSearchTokens.apply(this,arguments);return t.searchNotes&&this._data.extra&&!this.passwordProtected()&&e.push(r.decryptMobile(this._data.extra,!0,this.getKey())),e},AccountBase.prototype.getCloneData=function(){var t=this.getFormData(DialogInput.getProperties(this._data));return t.name=t.name+" - "+Strings.translateString("Copy"),delete t.aid,t},AccountBase.prototype.processEnteredData=function(t,e,a){VaultItem.prototype.processEnteredData.apply(this,arguments),t.encgroup=this.encryptIfNecessary("encgroup",t.group,a),t.encname=this.encryptIfNecessary("encname",t.name,a),t.action&&(t.action=bg.AES.bin2hex(t.action))},AccountBase.prototype.isShared=function(){return VaultItem.prototype.isShared.apply(this,arguments)||this._data.individualshare||this._data.sharedfromaid},AccountBase.prototype.isSharingEnabled=function(){return!(null!==this.getSharedGroup()||this._data.individualshare&&this._data.sharedfromaid&&""!==this._data.sharedfromaid)},AccountBase.prototype.copyUsername=function(){r.copyUsername(this)},AccountBase.prototype.copyPassword=function(t){this.passwordProtect(function(){r.copyPassword(this,t)})},AccountBase.prototype.isReceivedShare=function(){return this._data.individualshare&&this._data.sharedfromaid}}(),function(){AccountBaseWithFields.prototype.REPROMPT_TYPE_VIEW_PW="view_pw_prompt",AccountBaseWithFields.prototype.getFormData=function(t){var e=AccountBase.prototype.getFormData.apply(this,arguments);e.fields=[];for(var a=0,r=this._data.fields.length;a<r;++a){var o=this._data.fields[a],n={name:o.name||o.id,type:o.type,value:this.getFieldValue(o,!0),formname:o.formname};"checkbox"===n.type&&(n.valueAttribute=o.value),e.fields.push(n)}return e.save_all=this._data.save_all,e},AccountBaseWithFields.prototype.processEnteredData=function(t,e,a,r){AccountBase.prototype.processEnteredData.apply(this,arguments);var o=this.getKey(),n=t.unencryptedUsername;if(t.username=this.encryptIfNecessary("username",t.unencryptedUsername,a),t.password=this.encryptIfNecessary("password",t.password,a),t.extra=this.encryptIfNecessary("extra",t.extra,a),t.fields)for(var s=0;s<t.fields.length;++s){var i=t.fields[s],p=this.getFieldValue(i),u=this._data.fields[s],c=p!==this.getFieldValue(u,!0);c||o!==a||i.formname!==u.formname||i.name!==u.name?(this.processEnteredFieldData(i,e,a),p===n&&"password"!==i.type?i.value=t.username:t.password&&"password"===i.type?i.value=t.password:r.saveFields=!0):t.fields[s]=u}},AccountBaseWithFields.prototype.getFieldValue=function(t,e){var a=null;if(t)switch(a=t.value,t.type){case"checkbox":void 0!==t.checked&&(a=t.checked);break;case"radio":case"select":case"select-one":break;default:e&&(a=r.decryptMobile(t.value,!0,this.getKey()))}return a},AccountBaseWithFields.prototype.processEnteredFieldData=function(t,e,a){switch(this.defaultFieldValues(t),t.type){case"checkbox":t.checked=t.value,t.value=t.valueAttribute||"";break;case"radio":case"select":case"select-one":break;default:void 0===a&&(a=e?e.getKey():this.getKey()),t.value=r.encryptMobile(t.value,!0,a)}},AccountBaseWithFields.prototype.getFieldPostData=function(t,e){var a=t.value;switch(t.type){case"checkbox":e&&(a+=t.checked?"-1":"-0");break;case"radio":a+="-1";break;case"select":case"select-one":break;default:a=r.encryptWithBTOA(t.value)}var o={name:t.name,type:t.type,value:a,urid:t.urid};return t.formname&&(o.formname=t.formname),o},AccountBaseWithFields.prototype.defaultFieldValues=function(){var t={checked:!1,formname:"",name:"",otherfield:!1,otherlogin:"0",type:"",urid:"0",url:"",value:""};return function(e){this.defaultFields(t,e)}}(),AccountBaseWithFields.prototype.removeField=function(t){this._data.fields.splice(t,1)},AccountBaseWithFields.prototype.addField=function(e,a){return void 0===a&&(a=this._data.fields),e=t.extend({},e),this.defaultFieldValues(e),a.push(e),a.length-1},AccountBaseWithFields.prototype.canViewPassword=function(){var t=this.getSharedGroup();return!t||t.hasPasswordAccess()},AccountBaseWithFields.prototype.cloneItem=function(){this.canViewPassword()?this.passwordProtect(function(){Topics.get(this.getEditTopicID()).publish({defaultData:this.getCloneData()})},{types:this.REPROMPT_TYPE_VIEW_PW}):Topics.get(Topics.ERROR).publish(Strings.translateString("This is a shared site. You are not permitted to copy the password."))}}(),function(){Account.prototype.REPROMPT_TYPE="edit_site_prompt",Account.prototype.isURLLaunchable=function(){return this._data.url&&0===this._data.url.indexOf("http://")||0===this._data.url.indexOf("https://")||0===this._data.url.indexOf("ssh://")},Account.prototype.isSharingEnabled=function(){return(!this._data.url||this.isURLLaunchable())&&AccountBase.prototype.isSharingEnabled.apply(this,arguments)},Account.prototype.isLaunchEnabled=function(){return this.isURLLaunchable()},Account.prototype.canViewPassword=function(){return AccountBaseWithFields.prototype.canViewPassword.apply(this,arguments)&&!this.isReceivedShare()},Account.prototype.getEditTopicID=function(){return Topics.EDIT_SITE},Account.prototype.getPassword=function(){if(this._data.save_all){for(var t=0,e=this._data.fields.length;t<e;++t){var a=this._data.fields[t];if("password"===a.type&&a.value)return r.decryptMobile(a.value,!0,this.getKey())}return""}return r.decryptMobile(this._data.password,!0,this.getKey())},Account.prototype.getSearchTokens=function(t){var e=AccountBaseWithFields.prototype.getSearchTokens.apply(this,arguments),a=this.getUsername();return a&&e.push(a),this._data.url&&e.push(bg.hostof(this._data.url)),e},Account.prototype.getRepromptType=function(){return this.REPROMPT_TYPE},Account.prototype.getUsername=function(){if(this._data.save_all)for(var t=0,e=this._data.fields.length;t<e;++t){var a=this._data.fields[t];switch(a.type){case"text":case"email":case"tel":if(a.value)return r.decryptMobile(a.value,!0,this.getKey())}}return void 0===this._data.unencryptedUsername&&(this._data.unencryptedUsername=r.decryptMobile(this._data.username,!0,this.getKey())),this._data.unencryptedUsername},Account.prototype.hasGeneratedPassword=function(){return this._data.genpw||0===this.getName().indexOf(Strings.Vault.GENERATED_PREFIX)},Account.prototype.toString=function(){return Strings.Vault.SITE+": "+this._data.name},Account.prototype.handleClickEvent=function(t,e){switch(t){case Constants.ACTION_COPY_URL:this.copyURL();break;case Constants.ACTION_LAUNCH:this.launch();break;case Constants.ACTION_GO_TO_URL:this.goToURL();break;case Constants.ACTION_FILL_SITE:this.fill();break;default:AccountBase.prototype.handleClickEvent.apply(this,arguments)}},Account.prototype.launch=function(){var t=function(){r.launchSite(this)};return function(){this.passwordProtect(t,{types:"login_site_prompt"})}}(),Account.prototype.fill=function(){var t=function(){r.fillSite(this)};return function(){this.passwordProtect(t,{types:"login_site_prompt"})}}(),Account.prototype.copyPassword=function(t){this.canViewPassword()?this.passwordProtect(function(){r.copyPassword(this,t)},{types:this.REPROMPT_TYPE_VIEW_PW}):Topics.get(Topics.ERROR).publish(Strings.translateString("This is a shared site. You are not permitted to copy the password."))},Account.prototype.copyURL=function(){r.copyURL(this)},Account.prototype.goToURL=function(){r.goToURL(this)},Account.prototype.processEnteredData=function(t,e,a){t.save_all&&(delete t.unencryptedUsername,delete t.password),AccountBaseWithFields.prototype.processEnteredData.apply(this,arguments),t.url&&(t.url=bg.punycode.URLToASCII(t.url.trim())),t.realm_data&&(t.realm_data=r.encryptMobile(t.realm_data,!0,a))},Account.prototype.getFormData=function(t){var e=AccountBaseWithFields.prototype.getFormData.apply(this,arguments);return t.password&&(e.password=this.getPassword()),t.unencryptedUsername&&(e.unencryptedUsername=this.getUsername()),e};var t=function(t,e){for(var a=r.getDomain(t.getURL()),o=[],n=r.getSiteModels(),s=0,i=n.length;s<i;++s){var p=n[s];p!==t&&r.getDomain(p.getURL())===a&&p.getPassword()===e&&o.push(p)}o.length>0&&dialogs.changePassword.open({domain:a,items:o,newPassword:t.getPassword()})};Account.prototype.save=function(e,a,o){!function(n){LPRequest.makeUpdateRequest(r.saveSite,{parameters:[n,e,a,o],success:function(e){var r=n.getPassword();n.update(e,a),
n.publishSuccess(Strings.Vault.SAVED),r!==n.getPassword()&&t(n,r),o.success&&o.success(n)}})}(this)},Account.prototype.add=function(t,e){!function(a){LPRequest.makeUpdateRequest(r.addSite,{parameters:[a,t,e],success:function(r){a.update(r,t),a.publishAdd(Topics.SITE_ADDED,t),e.success&&e.success(a)}})}(this)},Account.prototype.getPostData=function(t,e,o){var n=AccountBaseWithFields.prototype.getPostData.apply(this,arguments);n.username=t.username?r.encryptWithBTOA(t.username):"",n.password=t.password?r.encryptWithBTOA(t.password):"";var s=bg.AES.url2hex(t.url);return a.getOption(o,"saveFromSubmit",!1)?(n.ref=s,this.isNew()||(n.replacing=1)):n.url=s,t.never_autofill&&(n.never_autofill="on"),t.autologin&&(n.autologin="on"),(t.save_all||a.getOption(o,"saveFromSubmit",!1))&&(n.data=this.getFieldFormData(t.fields)),t.save_all&&(n.save_all=1),n.urid=t.urid,"1"===t.basic_auth&&(n.basic_auth="1"),t.realm_data&&(n.realm=r.encryptWithBTOA(t.realm_data)),n}}(),Account.prototype.getFieldFormData=function(t){for(var e="",a=0,r=t.length;a<r;++a){var o=t[a],n=this.getFieldPostData(o,!0).value;e+=o.formname+"\t"+encodeURIComponent(o.name)+"\t"+encodeURIComponent(n)+"\t"+encodeURIComponent(o.type)+"\n"}return bg.AES.bin2hex(e)},function(){Application.prototype.toString=function(){return Strings.Vault.APPLICATION+" "+this.getName()},Application.prototype.getEditTopicID=function(){return Topics.EDIT_APPLICATION},Application.prototype.shouldPasswordProtectShare=function(){return!1},Application.prototype.getCloneData=function(){var t=AccountBaseWithFields.prototype.getCloneData.apply(this,arguments);return delete t.appaid,t},Application.prototype.getID=function(t){var e=this._data.appaid;return t&&(e="app"+e),e},Application.prototype.setID=function(t){this._data.appaid=t},Application.prototype.isSharingEnabled=function(){return!1},Application.prototype.getLastTouch=AccountBase.prototype.getLastTouch,Application.prototype.handleClickEvent=function(t,e){switch(t){case Constants.ACTION_LAUNCH:r.launchApplication(this);break;default:AccountBaseWithFields.prototype.handleClickEvent.apply(this,arguments)}},Application.prototype.update=function(){AccountBaseWithFields.prototype.update.apply(this,arguments),this.setSaveAll()},Application.prototype.addField=function(){AccountBaseWithFields.prototype.addField.apply(this,arguments),this.setSaveAll()},Application.prototype.removeField=function(){AccountBaseWithFields.prototype.removeField.apply(this,arguments),this.setSaveAll()},Application.prototype.setSaveAll=function(){for(var t,e,a=0;a<this._data.fields.length;++a){var o=this._data.fields[a];switch(o.type){case"password":t=void 0===t?o:null;break;case"":e=void 0===e?o:null}}e&&t?(this._data.save_all=!1,this._data.unencryptedUsername=r.decryptMobile(e.value,!0,this.getKey()),this._data.username=e.value,this._data.password=t.value):(this._data.save_all=!0,delete this._data.unencryptedUsername,delete this._data.username,delete this._data.password)},Application.prototype.getUsername=function(){for(var t=0;t<this._data.fields.length;++t){var e=this._data.fields[t];if("password"!==e.type&&e.value)return r.decryptMobile(e.value,!0,this.getKey())}},Application.prototype.getPassword=function(){for(var t=0;t<this._data.fields.length;++t){var e=this._data.fields[t];if("password"===e.type&&e.value)return r.decryptMobile(e.value,!0,this.getKey())}},Application.prototype.getFormData=function(t){var e=AccountBaseWithFields.prototype.getFormData.apply(this,arguments);return this._data.save_all||(e.password=r.decryptMobile(this._data.password,!0,this.getKey())),e},Application.prototype.getSearchTokens=function(){var t=VaultItem.prototype.getSearchTokens.apply(this,arguments);return t.push(this._data.appname),t},Application.prototype.add=function(t,e){!function(a){LPRequest.makeUpdateRequest(r.addApplication,{parameters:[a,t,e],success:function(e){a.update(e,t),a.publishAdd(Topics.APPLICATION_ADDED,t)}})}(this)},Application.prototype.save=function(t,e,a){!function(o){LPRequest.makeUpdateRequest(r.saveApplication,{parameters:[o,t,e,a],success:function(){o.update(t,e),o.publishSuccess(Strings.Vault.SAVED)}})}(this)},Application.prototype.getPostData=function(t,e){var a=AccountBase.prototype.getPostData.apply(this,arguments);if(a.appname=t.appname,t.fields)for(var r=0;r<t.fields.length;++r){var o=t.fields[r];a["fieldid"+r]=o.name||o.id,a["fieldtype"+r]=o.type,a["fieldvalue"+r]=this.getFieldPostData(o).value}return a.appaid=a.aid,delete a.aid,this.isNew()||(a.cmd="updatelpaa"),a}}(),function(){Group.prototype.getDisplayClass=function(){return GroupDisplay},Group.prototype.toString=function(){return Strings.Vault.GROUP+" "+this._data.group},Group.prototype.getName=function(){return this._data.group},Group.prototype.getGroupName=function(){return this._data.group.substring(this._data.group.lastIndexOf("\\")+1)},Group.prototype.handleClickEvent=function(t,e){switch(t){case Constants.ACTION_RENAME:Topics.get(Topics.RENAME_FOLDER).publish(this);break;case Constants.ACTION_CREATE_SUB_FOLDER:Topics.get(Topics.CREATE_SUB_FOLDER).publish(this);break;case Constants.ACTION_SHARE:Topics.get(Topics.CREATE_SHARED_FOLDER).publish(this,e.itemsForAction);break;default:VaultItemBase.prototype.handleClickEvent.apply(this,arguments)}},Group.prototype.confirmDelete=function(){return this._itemCount>0?function(t){return function(e,a){Topics.get(Topics.CONFIRM).publish(Strings.Vault.DELETE,Strings.translateString(o,Strings.translateString("%1 containing %2 item(s)",t.toString(),t._itemCount)),e,a)}}(this):VaultItemBase.prototype.confirmDelete.apply(this)},Group.prototype.deleteItem=function(t){LPRequest.makeLockItemUpdateRequest(r.deleteFolder,{parameters:[t.itemsForAction],items:t.itemsForAction,success:function(t){return function(){t.deleteUpdates()}}(this),confirm:this.confirmDelete()})},Group.prototype.add=function(t){!function(e){LPRequest.makeUpdateRequest(r.addGroup,{parameters:e,success:function(a){e.update(a,t),e.publishAdd(Topics.GROUP_ADDED,t)}})}(this)},Group.prototype.save=function(t,e){!function(a){LPRequest.makeUpdateRequest(r.renameGroup,{parameters:[a,t],success:function(){a.update(t,e),a.publishSuccess(Strings.Vault.RENAMED)}})}(this)},Group.prototype.getFormData=function(t){var e=VaultItemBase.prototype.getFormData.apply(this,arguments);return e.groupName=this.getGroupName(),e.groupParent=this.getGroupParentName(),e},Group.prototype.processEnteredData=function(t){VaultItemBase.prototype.processEnteredData.apply(this,arguments),t.groupName&&(t.groupParent?(t.group=t.groupParent+"\\"+t.groupName,delete t.groupParent):t.group=t.groupName,delete t.groupName)}}(),function(){SharedGroup.prototype.setID=function(t){Group.prototype.setID.apply(this,arguments),this._data.sharefolderid=t,this._shareInfo.id=t,this._shareInfo.shareid=t},SharedGroup.prototype.useSharePrefix=function(){return!0},SharedGroup.prototype.update=function(t){t&&(this._shareInfo.decsharename=t.group),Group.prototype.update.apply(this,arguments)},SharedGroup.prototype.isReadOnly=function(){return"1"===this._shareInfo.readonly},SharedGroup.prototype.canAdminister=function(){return"1"===this._shareInfo.can_administer},SharedGroup.prototype.isPending=function(){return"0"===this._shareInfo.accepted},SharedGroup.prototype.canConvertToEnterprise=function(){return r.isEnterpriseUser()&&this.canAdminister()&&"1"===this._shareInfo.outside_enterprise&&"0"===this._shareInfo.cid},SharedGroup.prototype.isDownloaded=function(){return"1"===this._shareInfo.download},SharedGroup.prototype.hasPasswordAccess=function(){return"1"===this._shareInfo.give},SharedGroup.prototype.isDeleted=function(){return"1"===this._shareInfo.deleted},SharedGroup.prototype.isSharingEnabled=function(){return!1},SharedGroup.prototype.getShareName=function(){return this._shareInfo.sharename},SharedGroup.prototype.handleClickEvent=function(t,e){switch(t){case Constants.ACTION_START_DOWNLOADING:this.startDownloading();break;case Constants.ACTION_STOP_DOWNLOADING:this.stopDownloading();break;case Constants.ACTION_MANAGE:this.manage();break;case Constants.ACTION_RESTORE_SHARED_FOLDER:this.restoreSharedFolder();break;case Constants.ACTION_PURGE_SHARED_FOLDER:this.purgeSharedFolder();break;case Constants.ACTION_ACCEPT:this.accept();break;case Constants.ACTION_REJECT:this.reject();break;default:Group.prototype.handleClickEvent.apply(this,arguments)}},SharedGroup.prototype.manage=function(){var t=function(){this.canConvertToEnterprise()?this.convertToEnterprise():Topics.get(Topics.EDIT_SHARED_FOLDER).publish(this)};return function(){this.passwordProtect(t)}}(),SharedGroup.prototype.accept=function(){var t=function(t){Topics.get(Topics.UPDATE_NOTIFICATION_COUNT).publish(),this.refresh(t.sharedFolder,t.shareInfo),this.update()};return function(){LPRequest.makeRequest(bg.BackgroundServer.sharing.folder.accept,{params:{sharedFolder:this._data,shareInfo:this._shareInfo},lockItems:!0,items:this,success:this.createHandler(t)})}}(),SharedGroup.prototype.reject=function(){var t=function(){Topics.get(Topics.UPDATE_NOTIFICATION_COUNT).publish(),this.deleteUpdates(!1)};return function(){LPRequest.makeUpdateRequest(bg.BackgroundServer.sharing.folder.reject,{params:{sharedFolder:this._data,shareInfo:this._shareInfo},lockItems:!0,items:this,success:this.createHandler(t),confirm:{title:Strings.Vault.REJECT,text:[Strings.translateString("Are you sure you want to reject %1?",this.toString())]}})}}(),SharedGroup.prototype.stopDownloading=function(){var t=function(t){this.refresh(t.sharedFolder,t.shareInfo),this.update()};return function(){LPRequest.makeUpdateRequest(r.stopDownloadingFolder,{params:{sharedFolder:this._data,shareInfo:this._shareInfo},lockItems:!0,items:this,success:this.createHandler(t),successMessage:Strings.translateString("%1 will no longer be downloaded.",this.toString()),confirm:{title:Strings.Vault.STOP_DOWNLOADING,text:[Strings.translateString("You are choosing to prevent downloading the contents of this Shared Folder to your vault. This is may improve performance if you have a lot of items in Shared Folders that are not regularly used. You may always begin to download the folder contents again in the Sharing Center."),Strings.translateString("Do you want to continue?")]}})}}(),SharedGroup.prototype.add=function(){var e=function(t,e,a){var r=[],o={};if(t){var n=t.getName(),s=a.getName(),i=function(t){r.push(t.getID()),o[t.getID()]=t._data.group.replace(n,s)};if(e)for(var p=0,u=e.length;p<u;++p){var c=e[p];c instanceof DummyGroup||i(c)}t instanceof DummyGroup||i(t)}return{itemsToMove:r,parentMap:o}};return function(a,o){var n=e(a,o,this);LPRequest.makeUpdateRequest(r.createSharedFolder,{params:{sharedFolder:this._data,shareInfo:this._shareInfo},successMessage:n.itemsToMove.length>0?"":void 0,success:this.createHandler(function(e){this.refresh(e.sharedFolder,e.shareInfo),this.update(),n.itemsToMove.length>0?LPRequest.makeRequest(r.moveIntoSharedFolder,{params:t.extend(n,{toShareInfo:this._shareInfo}),success:this.createHandler(function(){this.publishAdd(Topics.GROUP_ADDED),o&&o.forEach(function(t){t.update(t._data,this)},this),a&&a.destruct()})}):(this.publishAdd(Topics.GROUP_ADDED),a&&a.destruct())})})}}(),SharedGroup.prototype.deleteItem=function(){var t=function(t){this.refresh(t.sharedFolder,t.shareInfo),this.update()};return function(){LPRequest.makeLockItemUpdateRequest(r.deleteSharedFolder,{params:{sharedFolder:this._data,shareInfo:this._shareInfo},items:this,success:this.createHandler(t),successMessage:this.getSuccessMessage(Strings.Vault.DELETED),confirm:this.confirmDelete()})}}(),SharedGroup.prototype.getFormData=function(t){var e=Group.prototype.getFormData.apply(this,arguments);return e.groupName=this.getShareGroupName(),e},SharedGroup.prototype.processEnteredData=function(t){t.group=this.SHARED_FOLDER_NAME_PREFIX+t.groupName,delete t.groupName},SharedGroup.prototype.getShareGroupName=function(t){return void 0===t&&(t=this._data.group),t.substring(this.SHARED_FOLDER_NAME_PREFIX.length)},SharedGroup.prototype.saveFromDialog=function(t,e){VaultItem.prototype.saveFromDialog.apply(this,arguments)},SharedGroup.prototype.save=function(){var t=function(t){this.refresh(t.sharedFolder,t.shareInfo),this.update()};return function(e){LPRequest.makeUpdateRequest(r.renameSharedGroup,{params:{sharedFolder:e,shareInfo:this._shareInfo},success:this.createHandler(t),successMessage:this.getSuccessMessage(Strings.Vault.RENAMED)})}}(),SharedGroup.prototype.getKey=function(){return this._shareInfo.key},SharedGroup.prototype.getSharedGroup=function(){return this},SharedGroup.prototype.startDownloading=function(){var t=function(t){this.refresh(t.sharedFolder,t.shareInfo),this.update()};return function(){LPRequest.makeRequest(r.startDownloadingFolder,{params:{sharedFolder:this._data,shareInfo:this._shareInfo},lockItems:!0,items:this,success:this.createHandler(t),successMessage:Strings.translateString("%1 will now be downloaded.",this.toString())})}}(),SharedGroup.prototype.restoreSharedFolder=function(){var t=function(t){this.refresh(t.sharedFolder,t.shareInfo),this.update()};return function(){LPRequest.makeRequest(r.restoreDeletedSharedFolder,{params:{sharedFolder:this._data,shareInfo:this._shareInfo},lockItems:!0,items:this,success:this.createHandler(t),successMessage:this.getSuccessMessage(Strings.Vault.RESTORED)})}}(),SharedGroup.prototype.purgeSharedFolder=function(){var t=function(){this.publishSuccess(Strings.Vault.PURGED),this.deleteUpdates(!1)};return function(){LPRequest.makeLockItemUpdateRequest(r.purgeDeletedSharedFolder,{params:{sharedFolder:this._data,shareInfo:this._shareInfo},items:this,success:this.createHandler(t),confirm:{title:Strings.Vault.PURGE,text:Strings.translateString(Strings.VaultDynamic.CONFIRM_PURGE,this.toString())}})}}(),SharedGroup.prototype.convertToEnterprise=function(){var t=function(t){this.refresh(t.sharedFolder,t.shareInfo),this.update()};return function(){LPRequest.makeLockItemUpdateRequest(bg.BackgroundServer.sharing.folder.convertToEnterprise,{params:{sharedFolder:this._data,shareInfo:this._shareInfo},items:this,success:this.createHandler(t),confirm:{title:Strings.translateString("Convert to Enterprise"),text:[Strings.translateString("This was a shared family folder, but you are now a part of a LastPass Enterprise account.  In order to continue administering this shared folder, you must move it into the enterprise account.  This may mean certain other members of the enterprise account will have access to it."),Strings.translateString("Do you want to continue?")]}})}}(),SharedGroup.prototype.toString=function(){return Strings.Vault.SHARED_FOLDER+": "+this.getName()}}(),function(){LinkedGroup.prototype.useSharePrefix=function(){return!1},LinkedGroup.prototype.handleClickEvent=function(t,e){switch(t){case Constants.ACTION_UNLINK:this.unlink();break;default:SharedGroup.prototype.handleClickEvent.apply(this,arguments)}},LinkedGroup.prototype.unlink=function(){var t=function(){Topics.get(Topics.SUCCESS).publish(Strings.translateString("Account (%1) unlinked.",this.getName())),this.deleteUpdates(!1),r.refreshSites(),Topics.get(Topics.ACCOUNT_UNLINKED).publish();for(var t=r.getFormFillModels(),e=0,a=t.length;e<a;++e){var o=t[e];o.getSharedGroup()===this&&o.deleteUpdates(!1)}};return function(){LPRequest.makeUpdateRequest(r.unlinkAccount,{params:{id:this.getID()},success:this.createHandler(t),confirm:{title:Strings.Vault.UNLINK,text:Strings.translateString("Are you sure you want to unlink your personal account (%1)",this.getName())}})}}(),EmergencyAccessGroup.prototype.unlink=function(){var t=function(){Topics.get(Topics.SUCCESS).publish(Strings.translateString("Account (%1) unlinked.",this.getName())),this.deleteUpdates(!1)};return function(){LPRequest.makeUpdateRequest(r.unlinkEmergencyAccessAccount,{params:{folderID:this.getID(),email:this.getName()},success:this.createHandler(t),confirm:{title:Strings.Vault.UNLINK,text:Strings.translateString("Are you sure you want to unlink your personal account (%1)",this.getName())}})}}()}(),function(){Note.prototype.NOTE_TYPES={BANK:"Bank Account",CREDIT:"Credit Card",DATABASE:"Database",DRIVERS_LICENSE:"Driver's License",EMAIL:"Email Account",GENERIC:"Generic",HEALTH_INSURANCE:"Health Insurance",IM:"Instant Messenger",INSURANCE:"Insurance",MEMBERSHIP:"Membership",PASSPORT:"Passport",SERVER:"Server",SSN:"Social Security",SOFTWARE_LICENSE:"Software License",SSH_KEY:"SSH Key",WIFI:"Wi-Fi Password"};var t=function(){var t={};for(var e in Note.prototype.NOTE_TYPES)t[Note.prototype.NOTE_TYPES[e]]=!0;return t}();Note.prototype.REPROMPT_TYPE="edit_sn_prompt";var e=function(t){if(t){var e=t.match(/^Custom_(\d+)$/);return e&&2==e.length}return!1},a=function(a){return e(a)||t[a]};Note.prototype.getNoteType=function(){if(void 0===this._noteType){var t=this._data.notetype?this._data.notetype:this.getKeyValuePairs().NoteType;this._noteType=a(t)?t:this.NOTE_TYPES.GENERIC}return this._noteType},Note.prototype.getTemplate=function(){return this._data.template},Note.prototype.isCustom=function(){return e(this.getNoteType())},Note.prototype.getAttachmentKey=function(){return this._data.attachkey?bg.AES.hex2bin(r.decrypt(this._data.attachkey,this.getKey())):null},Note.prototype.cloneItem=function(){this.passwordProtect(function(){Topics.get(Topics.EDIT_NOTE).publish({defaultData:this.getCloneData()})})},Note.prototype.getRepromptType=function(){return this.REPROMPT_TYPE},Note.prototype.getEditTopicID=function(){return Topics.EDIT_NOTE},Note.prototype.handleClickEvent=function(t,e){switch(t){case Constants.ACTION_COPY_NOTE:this.copyNote();break;case Constants.ACTION_COPY_KEY:this.copyPrivateKey();break;default:AccountBase.prototype.handleClickEvent.apply(this,arguments)}},Note.prototype.copyNote=function(){var t=function(){r.copyToClipboard(this.getNoteField("Notes")),bg.loglogin(this.getID())};return function(){this.passwordProtect(t)}}(),Note.prototype.copyPrivateKey=function(){var t=function(){var t=this.getPrivateKey();if(t.indexOf("-----BEGIN")===-1&&t.indexOf("END-----")===-1)r.copyToClipboard(t);else{for(var e=t.split(/-----BEGIN.*KEY----- | -----END.*KEY-----/),a=t.split(/-----/),o=e[1],n="",s=0,i=o.length;s<i;++s)n+=":"!==o.charAt(s-1)?o[s].replace(/\u0020/g,"\n"):o[s];var p="-----"+a[1]+"-----\n"+n+"\n-----"+a[3]+"-----";r.copyToClipboard(p)}bg.loglogin(this.getID())};return function(){this.passwordProtect(t)}}(),Note.prototype.getNoteField=function(t){var e=this.getKeyValuePairs();for(var a in e){var r=e[a];if(a===t&&""!==r)return r}return null},Note.prototype.getPassword=function(){return this.getNoteField("Password")},Note.prototype.hasPassword=function(){return null!==this.getPassword()},Note.prototype.getUsername=function(){return this.getNoteField("Username")},Note.prototype.hasUsername=function(){return null!==this.getUsername()},Note.prototype.getPrivateKey=function(){return this.getNoteField("Private Key")},Note.prototype.hasPrivateKey=function(){return null!==this.getPrivateKey()},Note.prototype.toString=function(){return Strings.Vault.SECURE_NOTE+": "+this._data.name},Note.prototype.getKeyValuePairs=function(){return function(t){var e=r.decryptMobile(this._data.extra,!0,this.getKey()),o=new DialogInput.NestedFields;if(e&&a(e.substring("NoteType:".length,e.indexOf("\n")))){e=e.split("\n");for(var n,s={},i=0,p=e.length;i<p;++i){var u=e[i],c=u.indexOf(":");if(c>0){var l=u.substring(0,c);if(void 0===s[l]&&("object"!=typeof t||t[l])){o[l]=u.substring(c+1),n=l,s[l]=!0;continue}}n&&(o[n]+="\n"+u)}}else o.Notes=e;return o}}(),Note.prototype.getFormData=function(t){var e=VaultItem.prototype.getFormData.apply(this,arguments);return e.extra=this.getKeyValuePairs(t.extra),e.notetype=this.getNoteType(),e.template=this._data.template,e},Note.prototype.processEnteredData=function(t,e,a){AccountBase.prototype.processEnteredData.apply(this,arguments);var o="";if(t.notetype!==this.NOTE_TYPES.GENERIC){o="NoteType:"+t.notetype;var n=t.extra;for(var s in n)o+="\n"+s+":"+n[s]}else o=t.extra.Notes;if(t.extra=this.encryptIfNecessary("extra",o,a),this.getKey()!==a&&(t.attachkey=r.encrypt(r.decrypt(this._data.attachkey,this.getKey()),a)),t.attacharraychanges&&t.attacharraychanges.add&&t.attacharraychanges.add.length>0){var i=this.getAttachmentKey();if(null===i)i=bg.SHA256(bg.lpCreatePass(32,1,1,1,1,1,1,1)),t.attachkey=r.encrypt(i,a),i=bg.AES.hex2bin(i);else if(!i)throw new AttachmentKeyException;for(var p=0,u=t.attacharraychanges.add.length;p<u;++p){var c=t.attacharraychanges.add[p],l=this.getID();"0"!==l&&(c.id=l+"-"+c.id,c.parent=l),c.filename=r.encrypt(c.filename,i)}}},Note.prototype.getPostData=function(){var t=function(t,e){if(e.attacharraychanges&&e.attacharraychanges.remove)for(var a=0,r=e.attacharraychanges.remove.length;a<r;++a)t["rmattach"+a]=e.attacharraychanges.remove[a]},e=function(t,e){if(e.attacharraychanges&&e.attacharraychanges.add)for(var a=0,r=e.attacharraychanges.add.length;a<r;++a){var o=e.attacharraychanges.add[a];t["filename"+a]=o.filename,t["mimetype"+a]=o.mimetype,t["attachid"+a]=o.id.substring(o.id.indexOf("-")+1),t["attachbytes"+a]=o.bytes}};return function(a){var r=AccountBase.prototype.getPostData.apply(this,arguments);return r.url=bg.AES.url2hex(this._data.url),r.username="",r.password="",r.template=a.template,r.hexName=bg.AES.url2hex(a.name),r.notetype=a.notetype,a.attachkey&&(r.attachkey=a.attachkey),t(r,a),e(r,a),r}}(),Note.prototype.update=function(){var t=function(t){if(t&&t.remove)for(var e=0,a=t.remove.length;e<a;++e)this.removeAttachment(t.remove[e])},e=function(t){if(t&&t.add)for(var e=0,a=t.add.length;e<a;++e)this.addAttachment(new Attachment(t.add[e]))};return function(a,r,o){AccountBase.prototype.update.apply(this,arguments),t.call(this,o),e.call(this,o),a.attachpresent=this._attachments.length>0?"1":""}}(),Note.prototype.add=function(t,e){!function(a,o){LPRequest.makeUpdateRequest(r.addNote,{parameters:[a,t,e],success:function(e){a.update(e,t,o),a.publishAdd(Topics.NOTE_ADDED,t)}})}(this,this._data.attacharraychanges)},Note.prototype.save=function(t,e,a){!function(o,n){LPRequest.makeUpdateRequest(r.saveNote,{parameters:[o,t,e,a],success:function(){o.update(t,e,n),o.publishSuccess(Strings.Vault.SAVED)}})}(this,t.attacharraychanges)},Note.prototype.hasAttachments=function(){return this._attachments.length>0},Note.prototype.getAttachments=function(){return this._attachments},Note.prototype.addAttachment=function(t){t.setParentNote(this),this._attachments.push(t)},Note.prototype.removeAttachment=function(t){for(var e=0,a=this._attachments.length;e<a;++e)this._attachments[e]!==t&&this._attachments[e].getID()!==t||this._attachments.splice(e,1)}}(),function(){Attachment.prototype.setParentNote=function(t){this._parentNote=t,t&&(this._data.parent=t.getID())},Attachment.prototype.getID=function(){return this._data.id},Attachment.prototype.getName=function(){if(null===this._filename)if(null!==this._data.filename&&this._data.filename.length){var t=this._parentNote?this._parentNote.getAttachmentKey():null;t&&(this._filename=r.decrypt(this._data.filename,t))}else{var e=this._data.mimetype,a="";0===e.indexOf("other:")?a="."+e.substring(6):0===e.indexOf("data:audio")?a="."+e.substring(11):0===e.indexOf("data:image")&&(a="."+e.substring(11)),this._filename="attachment"+a}return this._filename?this._filename:this._data.filename},Attachment.prototype.getType=function(){return this._data.mimetype},Attachment.prototype.getBytes=function(){return this._data.bytes},Attachment.prototype.handleClickEvent=function(t,e){switch(t){case Constants.ACTION_OPEN:this.open();break;case Constants.ACTION_SAVE:this.save();break;default:VaultItemBase.prototype.handleClickEvent.apply(this,arguments)}};var t=function(t){return function(){this._parentNote?t.apply(this,arguments):dialogs.alert.open({title:Strings.translateString("Error"),text:Strings.translateString("Attachment must be saved before it can be viewed.")})}};Attachment.prototype.open=t(function(){r.openAttachment(this)}),Attachment.prototype.save=t(function(){r.saveAttachment(this)}),Attachment.prototype.deleteItem=function(){Topics.get(Topics.ATTACHMENT_REMOVED).publish(this),this.destroyViews()}}(),function(){FormFill.prototype.REPROMPT_TYPE="view_ff_prompt",FormFill.prototype.FORM_FILL_TYPE_GENERIC="0",FormFill.prototype.FORM_FILL_TYPE_CREDIT_CARD="1",FormFill.prototype.getRepromptType=function(){return this.REPROMPT_TYPE},FormFill.prototype.getEditTopicID=function(){return Topics.EDIT_FORM_FILL},FormFill.prototype.getName=function(){return this._data.decprofilename},FormFill.prototype.getID=function(){return this._data.ffid},FormFill.prototype.setID=function(t){this._data.ffid=t},FormFill.prototype.isCreditCard=function(){return this._data.profiletype===this.FORM_FILL_TYPE_CREDIT_CARD},FormFill.prototype.toString=function(){return Strings.Vault.FORM_FILL+": "+this._data.decprofilename},FormFill.prototype.handleClickEvent=function(t,e){switch(t){case Constants.ACTION_FILL:this.fill(e);break;default:VaultItem.prototype.handleClickEvent.apply(this,arguments)}},FormFill.prototype.fill=function(t){var e=t?t.source:"vault";r.fillProfile(this,e)},FormFill.prototype.deleteItem=function(t){this.passwordProtect(function(e){return function(){LPRequest.makeLockItemUpdateRequest(r.deleteFormFill,{parameters:[e,t],items:e,success:function(){e.deleteUpdates()},confirm:e.confirmDelete()})}}(this))},FormFill.prototype.enableCreditMonitoring=function(){LPRequest.makeUpdateRequest(r.createCreditMonitoringProfile,{parameters:this})},FormFill.prototype.add=function(e,a){!function(e){LPRequest.makeUpdateRequest(r.addFormFill,{parameters:[e,a],success:function(t){e.update(t),e._data.creditmon&&e.enableCreditMonitoring(),e.publishAdd(Topics.FORM_FILL_ADDED)},confirm:e._data.creditmon?t(e._data,e.getKey()):null})}(this)};var t=function(){var t=function(t,e,r){var o=a.createElement("tr","settingsRow");if(o.appendChild(a.createElement("td","settingLabel",e)),"string"==typeof r)o.appendChild(a.createElement("td",null,r));else{var n=a.createElement("td");n.appendChild(r),o.appendChild(n)}t.appendChild(o)},e=function(t,e){var o=a.createElement("div");return t.address1&&o.appendChild(a.createElement("p",null,r.decryptMobile(t.address1,!0,e))),t.address2&&o.appendChild(a.createElement("p",null,r.decryptMobile(t.address2,!0,e))),t.address3&&o.appendChild(a.createElement("p",null,r.decryptMobile(t.address3,!0,e))),o.appendChild(a.createElement("p",null,r.decryptMobile(t.city,!0,e)+", "+r.decryptMobile(t.state,!0,e)+" "+r.decryptMobile(t.zip,!0,e))),o},o=function(t){return"•••• "+t.slice(-4)},n=function(t){return 11===t.length&&(t=t.substring(1)),"("+t.substring(0,3)+") "+t.substring(3,6)+"-"+t.substring(6)};return function(s,i){var p=[Strings.translateString("Only the below information will be sent to LastPass."),Strings.translateString("Other confidential Form Fill information, such as credit card numbers, will not be sent.")],u=a.createElement("table","settings creditMonConfirm");t(u,Strings.translateString("Name"),r.decryptMobile(s.firstname,!0,i)+" "+r.decryptMobile(s.lastname,!0,i)),t(u,Strings.translateString("Birthday"),r.decryptMobile(s.birthday,!0,i)),t(u,Strings.translateString("Social Security Number"),o(r.decryptMobile(s.ssn,!0,i))),t(u,Strings.translateString("Phone Number"),n(r.decryptMobile(s.phone,!0,i))),t(u,Strings.translateString("Address"),e(s,i)),a.addZebraStriping(u),p.push(u);var c=a.createElement("p",{compoundtranslation:!0,class:"dialogText"},"I have read and agree with the ");return c.appendChild(a.createElement("a",{target:"_blank",href:r.getBaseURL()+"creditmonitoring.php?cmd=showterms"},"LastPass Terms and Conditions")),Strings.translate(c),p.push(c),{title:Strings.Vault.ADD_CREDIT_MON,text:p,nextButtonText:Strings.translateString("I Agree"),backButtonText:Strings.translateString("I Do Not Agree")}}}();FormFill.prototype.save=function(e,a,o){!function(a){LPRequest.makeUpdateRequest(r.saveFormFill,{parameters:[a,e,o],success:function(){a.update(e),a.publishSuccess(Strings.Vault.SAVED)},confirm:e.creditmon&&!a._data.creditmon?t(e,a.getKey()):null})}(this)},FormFill.prototype.update=function(t){var e=!1;t.creditmon&&!this._data.creditmon&&(e=!0),VaultItem.prototype.update.apply(this,arguments),e&&this.enableCreditMonitoring()},FormFill.prototype.getPostData=function(t){var e=VaultItem.prototype.getPostData.apply(this,arguments),a=this.getKey();for(var o in t){var n=t[o];if(this.isEncryptedField(o))e[o]=r.encryptWithKey(r.decryptMobile(n,!0,a),a);else switch(o){case"creditmon":case"pwprotect":break;default:e[o]=n}}return e.ffid=this.getID(),void 0!==e.custom_fields&&delete e.custom_fields,t.creditmon&&(e.creditmon="on"),e},FormFill.prototype.isEncryptedField=function(t){if(t.indexOf("cfid")!==-1)return!1;switch(t){case"decprofilename":case"pwprotect":case"creditmon":case"custom_fields":case"profiletype":return!1;default:return!0}},FormFill.prototype.processEnteredData=function(t,e,a){for(var o in t){var n=t[o];if("custom_fields"===o)for(var s=0,i=n.length;s<i;++s){var p=n[s],u="customfield"+(s+1);t[u+"cfid"]=p.cfid,t[u+"text"]=r.encryptMobile(p.text,!0,a),t[u+"value"]=r.encryptMobile(p.value,!0,a),t[u+"alttext"]=""}else this.isEncryptedField(o)&&(t[o]=this.encryptIfNecessary(o,t[o],a))}delete t.custom_fields,t.profilename=r.encryptMobile(t.decprofilename,!0,a)},FormFill.prototype.getFormData=function(t){var e={},a=this.getKey();for(var o in t)this.isEncryptedField(o)?e[o]=r.decryptMobile(this._data[o],!0,a):e[o]=this._data[o];if(t.custom_fields){e.custom_fields=[];for(var n=0,s=this._data.custom_fields.length;n<s;++n){var i=this._data.custom_fields[n],p={};p.cfid=i.cfid,p.text=r.decryptMobile(i.text,!0,a),p.value=r.decryptMobile(i.value,!0,a);var u=r.decryptMobile(i.alttext,!0,a);""!==u&&(p.value+="\n"+u),e.custom_fields.push(p)}}return e}}(),function(){Identity.prototype.REPROMPT_TYPE="switch_identity_prompt",Identity.prototype.getRepromptType=function(){return this.REPROMPT_TYPE},Identity.prototype.getName=function(){return this._data.deciname},Identity.prototype.getID=function(){return this._data.iid},Identity.prototype.setID=function(t){this._data.iid=t},Identity.prototype.handleClickEvent=function(t,e){switch(t){case Constants.ACTION_ENABLE:this.enable();break;default:VaultItemBase.prototype.handleClickEvent.apply(this,arguments)}},Identity.prototype.getEditTopicID=function(t){return Topics.EDIT_IDENTITY},Identity.prototype.enable=function(){var t=function(){Topics.get(Topics.IDENTITY_ENABLE).publish(this),this._enabled=!0,this.updateViews()};return function(e){a.getOption(e,"reprompt",!0)?this.passwordProtect(function(){t.apply(this),e&&e.callback&&e.callback()}):t.apply(this)}}(),Identity.prototype.disable=function(){this._enabled=!1,this.updateViews()},Identity.prototype.processEnteredData=function(t,e,a){t.iname=r.encryptAES(t.deciname,a)},Identity.prototype.save=function(){var t=function(t){this.update(t),this.publishSuccess(Strings.Vault.SAVED)};return function(e){LPRequest.makeUpdateRequest(r.saveIdentity,{params:{identity:e},success:this.createHandler(t)})}}(),Identity.prototype.add=function(){var t=function(t){this.update(t),this.publishAdd(Topics.IDENTITY_ADDED)};return function(){LPRequest.makeUpdateRequest(r.addIdentity,{params:{identity:this._data},success:this.createHandler(t)})}}(),Identity.prototype.deleteItem=function(){var t=function(){this.deleteUpdates()},e=function(){r.logEvent("v_did"),LPRequest.makeLockItemUpdateRequest(r.deleteIdentity,{params:{id:this.getID()},items:this,success:this.createHandler(t),confirm:this.confirmDelete()})};return function(){if(this._enabled)return void Topics.get(Topics.ERROR).publish(Strings.translateString("%1 cannot be deleted while enabled.",this.toString()));this.passwordProtect(e)}}(),Identity.prototype.toString=function(){return Strings.Vault.IDENTITY+": "+this.getName()}}()}($,document,LPTools,LPProxy);