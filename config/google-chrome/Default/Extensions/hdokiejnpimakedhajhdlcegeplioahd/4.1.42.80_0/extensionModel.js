!function(){var t=!1;VaultItemBase.prototype.reprompt=function(e){var s=function(t){return function(){t.apply(this,arguments),LPPlatform.closePopup()}};return function(o,i){t=e.call(this,s(o),i)}}(VaultItemBase.prototype.reprompt),VaultItemBase.prototype.getSource=function(){return"icon"},VaultItemBaseDisplay.prototype.build=function(t){var e=["extensionMenuItem"];e=e.concat(this.getMenuItemClass());var s=LPTools.createElement("li",e);t&&t.additionalItemClasses&&LPTools.addClass(s,t.additionalItemClasses);var o=this.buildItemIconElement();null!==o&&s.appendChild(o);var i=this.buildItemInfoTextElements(t);i.length>0&&s.appendChild(i[0]);var n=this.buildMoreOptionsButtons();if(n)if(n instanceof Array)for(var a=0,l=n.length;a<l;++a)s.appendChild(n[a]);else s.appendChild(n);return s},VaultItemBaseDisplay.prototype.getMenuItemClass=function(){return"item"},VaultItemBaseDisplay.prototype.buildMoreOptionsButtons=function(){return LPTools.createElement("div",{class:"moreItem moreActions",vaultaction:Constants.ACTION_OPEN_MORE_OPTIONS,title:Strings.Vault.MORE_OPTIONS})},VaultItemBaseDisplay.prototype.buildItemIconElement=function(){var t=LPTools.createElement("div","itemIcon");return t.appendChild(this.getIconElement()),t.appendChild(LPTools.createElement("div","itemIconOverlay")),t},VaultItemBaseDisplay.prototype.buildItemMenuOption=function(t){var e=LPTools.createElement("li",{class:"extensionMenuItem",vaultaction:t});return e.textContent=Strings.Vault[Constants.CONTEXT_MENU_ITEMS[t]],LPPlatform.addEventListener(e,"click",this._eventHandler),e},VaultItemBaseDisplay.prototype.buildMoreOptions=function(t){var e=this.getContainer()._buildOptions;void 0===t&&(t=LPTools.getOption(e,"moreOptionsElement",this._element?this._element.parentElement:null)),LPTools.removeDOMChildren(t);var s=this.build(e);this.postBuild(s,e),t.appendChild(s),this._$_element.unbind("contextmenu");for(var o=this.getMoreOptions(),i=[],n=0,a=o.length;n<a;++n){var l=o[n];if(!this.isExcludedAction(l)){var p=this.buildItemMenuOption(l);i.push(p),t.appendChild(p)}}LPTools.addKeyBoardNavigation(i,{useRightArrow:!1,selectFirst:!0}),ExtensionDropdown.setGroupLabel(LPProxy.getGroupByName(this._model.getGroupName()))},VaultItemBaseDisplay.prototype.openMoreOptions=function(){this.pushState(LPTools.getOption(this.getContainer()._buildOptions,"moreOptionsState",void 0)),this.buildMoreOptions()},VaultItemBaseDisplay.prototype.pushState=function(t){t=t||ExtensionDropdown.State.GroupState,Topics.get(Topics.PUSH_STATE).publish(new t(this._parent))},VaultItemBaseDisplay.prototype.handleEvent=function(e,s){var o={source:"icon"};switch(e.type){case"click":var i=this.getVaultAction(e.target);switch(this.handleClickEvent(i,o),i){case Constants.ACTION_OPEN_MORE_OPTIONS:case Constants.ACTION_TOGGLE_OPEN:t=!0}t&&(e.stopPropagation(),e.preventDefault(),t=!1);break;case"contextmenu":this.handleClickEvent(Constants.ACTION_OPEN_MORE_OPTIONS,o),e.stopPropagation(),e.preventDefault()}},GroupDisplay.prototype.getDisplayName=function(){return this._model.getGroupName()},GroupDisplay.prototype.build=function(t){var e=VaultItemBaseDisplay.prototype.build.apply(this,arguments);return e.setAttribute("vaultaction",Constants.ACTION_TOGGLE_OPEN),e},GroupDisplay.prototype.buildItemIconElement=function(){return null},GroupDisplay.prototype.getMenuItemClass=function(){return"group"},GroupDisplay.prototype.buildMoreOptionsButtons=function(){return LPTools.createElement("div","more")},GroupDisplay.prototype.setupListeners=function(t,e){$(t).bind("click",this._eventHandler)},GroupDisplay.prototype.toggleOpen=function(){this.pushState(),this.rebuildItems(this._element.parentElement),ExtensionDropdown.setGroupLabel(this._model)};var e=function(t,e){for(var s=0,o=t.length;s<o;++s)e.push(t[s]._element)};GroupDisplay.prototype.rebuildItems=function(t){var s=this.getContainer();if(t=t||s._element,0===this._subGroups.length&&1===this._items.length&&LPTools.getOption(s._buildOptions,"autoExpandSingleItem",!0))this._items[0].buildMoreOptions(t);else{LPTools.removeDOMChildren(t);var o=this.favoritesGroup&&!this.favoritesGroup.isEmpty();o&&this.buildItems([this.favoritesGroup],t,s._buildOptions);var i=0,n=[],a=null;if(bg.get("g_nofolder_feature_enabled"))for(var l=0,p=this._subGroups.length;l<p;l++)this._subGroups[l]instanceof DefaultGroupDisplay?(a=this._subGroups[l],i=a._items?a._items.length:0):n.push(this._subGroups[l]);var r=a?n:this._subGroups;this.buildItems(r,t,s._buildOptions),this.buildItems(this._items,t,s._buildOptions),a&&i>0&&this.buildItems(a._items,t,s._buildOptions),r.length>0&&(this._items.length>0||i>0)&&r[r.length-1]._$_element.removeClass("last");var u=[];o&&u.push(this.favoritesGroup._element),e(r,u),e(this._items,u),a&&i>0&&e(a._items,u),LPTools.addKeyBoardNavigation(u,{rightArrowSelector:".moreItem",selectFirst:!0}),LPTools.getOption(s._buildOptions,"addLastClass",!0)||$(u[u.length-1]).removeClass("last")}},GroupDisplay.prototype.getItemContainer=function(){return this.getContainer()._element},GroupDisplay.prototype.getSubFolderContainer=GroupDisplay.prototype.getItemContainer,AccountDisplay.prototype.build=function(t){var e=VaultItemBaseDisplay.prototype.build.apply(this,arguments);return ExtensionDropdown.isMatchingSite(this._model.getID())?(e.setAttribute("vaultaction",Constants.ACTION_FILL_SITE),e.setAttribute("title",Strings.Vault.FILL+" "+this.getDisplayName())):(e.setAttribute("vaultaction",Constants.ACTION_LAUNCH),e.setAttribute("title",Strings.Vault.LAUNCH+" "+this.getDisplayName())),e},AccountDisplay.prototype.setupListeners=function(t,e){VaultItemBaseDisplay.prototype.setupListeners.apply(this,arguments)},AccountDisplay.prototype.getMoreOptions=function(){var t=[Constants.ACTION_COPY_USERNAME,Constants.ACTION_COPY_PASSWORD,Constants.ACTION_COPY_URL,Constants.ACTION_GO_TO_URL,Constants.ACTION_EDIT,Constants.ACTION_DELETE];return ExtensionDropdown.isMatchingSite(this._model.getID())&&t.unshift(Constants.ACTION_FILL_SITE),t},NoteDisplay.prototype.build=function(t){var e=VaultItemBaseDisplay.prototype.build.apply(this,arguments);return LPTools.addClass(e,"note"),e.setAttribute("vaultaction",Constants.ACTION_EDIT),e.setAttribute("title",Strings.Vault.EDIT+" "+this.getDisplayName()),e},NoteDisplay.prototype.getMoreOptions=function(){var t=[];return this._model.hasUsername()&&t.push(Constants.ACTION_COPY_USERNAME),this._model.hasPassword()&&t.push(Constants.ACTION_COPY_PASSWORD),t.push(Constants.ACTION_COPY_NOTE),this._model.hasPrivateKey()&&t.push(Constants.ACTION_COPY_KEY),t.push(Constants.ACTION_EDIT),t.push(Constants.ACTION_DELETE),t},NoteDisplay.prototype.setupListeners=function(t,e){VaultItemBaseDisplay.prototype.setupListeners.apply(this,arguments)},FormFillDisplay.prototype.getMoreOptions=function(){return[Constants.ACTION_EDIT,Constants.ACTION_FILL]},FormFillDisplay.prototype.setupListeners=function(t,e){VaultItemBaseDisplay.prototype.setupListeners.apply(this,arguments)},FormFillDisplay.prototype.build=function(t){var e=VaultItemBaseDisplay.prototype.build.apply(this,arguments);return LPTools.addClass(e,"formFill"),e.setAttribute("vaultaction",Constants.ACTION_FILL),e.setAttribute("title",Strings.Vault.FILL+" "+this.getDisplayName()),e},FormFillDisplay.prototype.includeCreditInfo=function(){return!1},IdentityDisplay.prototype.build=function(t){var e=VaultItemBaseDisplay.prototype.build.apply(this,arguments);return e.setAttribute("vaultaction",Constants.ACTION_ENABLE),e.setAttribute("title",Strings.Vault.ENABLE+" "+this.getDisplayName()),e},AllIdentityDisplay.prototype.build=IdentityDisplay.prototype.build,IdentityDisplay.prototype.buildMoreOptionsButtons=function(){return null},IdentityDisplay.prototype.openMoreOptions=function(){},MatchingAccountDisplay=function(t){AccountDisplay.call(this,t)},MatchingAccountDisplay.prototype=Object.create(AccountDisplay.prototype),MatchingAccountDisplay.prototype.constructor=MatchingAccountDisplay,MatchingAccountDisplay.prototype.build=function(t){var e=VaultItemBaseDisplay.prototype.build.apply(this,arguments);return e.setAttribute("vaultaction",Constants.ACTION_FILL_SITE),e.setAttribute("title",Strings.Vault.FILL+" "+this.getDisplayName()),LPTools.addClass(e,"matchingSite"),e},MatchingAccountDisplay.prototype.buildMoreOptionsButtons=function(){var t=[];return this.isExcludedAction(Constants.ACTION_COPY_USERNAME)||t.push(LPTools.createElement("div",{class:"moreItem copyUsername",title:Strings.Vault.COPY_USERNAME,vaultaction:Constants.ACTION_COPY_USERNAME})),this.isExcludedAction(Constants.ACTION_COPY_PASSWORD)||t.push(LPTools.createElement("div",{class:"moreItem copyPassword",title:Strings.Vault.COPY_PASSWORD,vaultaction:Constants.ACTION_COPY_PASSWORD})),t.push(LPTools.createElement("div",{class:"moreItem",title:Strings.Vault.MORE_OPTIONS,vaultaction:Constants.ACTION_OPEN_MORE_OPTIONS})),t},ApplicationDisplay.prototype.getMoreOptions=function(){return[Constants.ACTION_EDIT,Constants.ACTION_COPY_USERNAME,Constants.ACTION_COPY_PASSWORD,Constants.ACTION_DELETE]},ApplicationDisplay.prototype.build=function(t){var e=VaultItemBaseDisplay.prototype.build.apply(this,arguments);return LPFeatures.allowLaunchApplication()&&(e.setAttribute("vaultaction",Constants.ACTION_LAUNCH),e.setAttribute("title",Strings.Vault.LAUNCH+" "+this.getDisplayName())),e}}();