function LP_keypress_handler(e){return 27==e.keyCode?void LPInfieldFrame.close("close"):9==e.keyCode?void LPInfieldFrame.close("away"):void 0}var lpResizeEvent=function(){function e(){o||(o=setTimeout(function(){o=null,n()},66))}function n(){l&&l()}function i(n){l=n,window.addEventListener("resize",e)}function t(){l=null,window.removeEventListener("resize",e)}var o,l;return{attachWindowResizeEvent:i,detachWindowResizeEvent:t}}();LPInfieldFrame=function(){function e(e,n){var i;return function(){var t=this,o=arguments;clearTimeout(i),i=setTimeout(function(){i=null,e.apply(t,o)},n)}}function n(n){(v=v||e(i,100))(n)}function i(e){if(p)return void(p=!1);if(e.iframe&&!e.fieldEl)try{e.fieldEl=$(e.iframe).contents().find("#"+e.id)[0]}catch(e){}if(e&&("focus"!==e.eventType||!m)){if(s){if(u.id===e.id)return;o("away")}e.url=w,u=e,s=LPFrame.openFrame({url:w,interfaceDefinition:Interfaces.InfieldPopupInterface}),c(),a(),lpResizeEvent.attachWindowResizeEvent(a),window.addEventListener("click",t,!0),bg.sendLpImprove("newinfieldopen",{source:"formv2",option:e.eventType})}}function t(e){return(!u||e.target.id!==u.id&&e.target!==u.fieldEl)&&(o("away"),!0)}function o(e){s&&(e&&(p="action"==e,bg.sendLpImprove("newinfieldclose",{source:"formv2",option:e}),"close"===e&&(m=!0,u.fieldEl&&(LP_addEventHandler(u.fieldEl,"click",launchPopup,!1),realLaunchPopup&&u.fieldEl.removeEventListener("focus",realLaunchPopup)))),window.removeEventListener("click",t),lpResizeEvent.detachWindowResizeEvent(),s&&s.close(),s=null,u=null)}function l(e,n){var i={};return e&&(i.height=e),n&&(i.width=n),i}function f(e){var n={top:0,left:0};if(e){var i={top:0,left:0};e.iframe&&(i=e.iframe.getBoundingClientRect());var t={bottom:parseInt(e.posy),left:parseInt(e.posx),width:e.width};e.fieldEl&&e.fieldEl.getBoundingClientRect?t=e.fieldEl.getBoundingClientRect():e.fieldBox&&(t=e.fieldBox),n.top=window.pageYOffset+i.top+t.bottom,n.left=window.pageXOffset+i.left+t.left+t.width-375;var o=360;n.left<=0&&(n.left=window.pageXOffset+i.left+t.left-10,o=25)}return r(o),n}function r(e){s&&s.getInterface().lpInfield.setArrowPosition({position:e})}function c(){s&&s.css({display:"block",position:"absolute",height:"0px"})}function d(e,n){s&&s.css(l(e,n))}function a(){u.fieldEl&&!$(u.fieldEl).is(":visible")?o():s&&s.css(f(u))}var s,u,p,v,w="contentScriptPopup.html",m=!1;return{close:o,show:c,openFrame:n,resizeFrame:d,positionFrame:a}}();