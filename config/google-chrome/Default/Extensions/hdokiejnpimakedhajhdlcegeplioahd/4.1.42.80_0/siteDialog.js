var SiteDialog=function(A){EditableFieldsDialog.call(this,A,{closeButtonEnabled:!0,maximizeButtonEnabled:!0,dynamicHeight:!0,type:Account}),this.changePasswordButton=null};SiteDialog.prototype=Object.create(EditableFieldsDialog.prototype),SiteDialog.prototype.constructor=SiteDialog,function(){var A=function(A){var t=A.domain;return""!==A.a&&(t=A.a+" ("+A.domain+")"),t};SiteDialog.prototype.initialize=function(e){EditableFieldsDialog.prototype.initialize.apply(this,arguments),this.changePasswordButton=$("#autoChangePassword"),this.inputFields.password.getElement().LP_addPasswordMeter(this.inputFields.unencryptedUsername.getElement()),this.inputFields.url=new BloodhoundDropdown(document.getElementById("siteDialogURL"),{identify:function(A){return A.domain},remote:{url:LPProxy.getBaseURL()+"typeahead_addsite.php?q=%QUERY",wildcard:"%QUERY"}},{optionLabel:function(t){return A(t)},elementTemplate:{template:function(t){var e=""!==t.favicon?t.favicon:"R0lGODlhEAAQAIcAAAAAAExnf1BpgWR0iHZ6hHeBkX+GkYiOmpeaopucoaSlqqWmqrm9w7q+xL+/wry/xcXGyc3Oz9HS1NPU1tnZ2d/h4+Di5OLj5uPl5+Tk5OXm6O7u7+7v8O/w8e/w8vDw8fHx8vLy8/Pz8/Pz9PT09fX19fX29vb29vf39/f3+Pj4+Pj4+fn5+vr6+/v7/Pz8/P39/f7+/v///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAAAAALAAAAAAQABAAAAiQAAEIHEiw4MAFCBEmQCjBIIAFMiLK8CBjA4QIBiFu2Fgh4oYJDgpq5Chxw4KCCiqSlKigIAKVGyowYNDgAYGCB2BWsHABgwYDBQvA/CCiBAoVBQoOUNlBhAkVLV4MKCigIgenK1zAiCGgYICKIEhAhRExgFcZHEKcYEG27NkOI1K0aCvDLMEAePPqteuwr8CAADs=",a=LPTools.createElement("li","siteTypeaheadOption"),i=LPTools.createElement("div","itemIcon"),o=LPTools.createElement("img",{src:"data:image/gif;base64,"+e});return a.appendChild(i),a.appendChild(LPTools.createElement("span","siteTypeaheadOptionText",A(t))),i.appendChild(o),a},value:function(A){return A.url},hint:function(t){return A(t)}}}),this.addFavButton().appendChild(this.editFormFieldsButton.get(0)),function(A){A.inputFields.url.onChange(function(t){var e=LPProxy.getDomain(t.domain),a=e.indexOf("."),i=e.charAt(0).toUpperCase()+e.substring(1,a>0?a:e.length);if(A.inputFields.name.setValue(i),!bg.get("g_nofolder_feature_enabled")){var o=bg.get("siteCats");o&&o[e]&&A.inputFields.group.setValue(o[e])}}),e.find("#siteDialogPasswordHistory").bind("click",function(){if(!A.vaultItem.canViewPassword())return void Topics.get(Topics.ERROR).publish(Strings.translateString("This is a shared site. You are not permitted to view the password."));LPProxy.reprompt(function(){LPRequest.makeRequest(LPProxy.getPasswordHistory,{parameters:[A.vaultItem.getID(),A.vaultItem.getShareID()],success:function(e){t(e,A.vaultItem,Constants.HISTORY_TYPES.PASSWORD)},requestSuccessOptions:{closeDialog:!1}}),bg.loglogin(A.vaultItem.getID())},{types:AccountBaseWithFields.prototype.REPROMPT_TYPE_VIEW_PW})}),e.find("#siteDialogUsernameHistory").bind("click",function(){LPRequest.makeRequest(LPProxy.getUsernameHistory,{parameters:[A.vaultItem.getID(),A.vaultItem.getShareID()],success:function(e){t(e,A.vaultItem,Constants.HISTORY_TYPES.USERNAME)},requestSuccessOptions:{closeDialog:!1}})}),e.find("#siteDialogNoteHistory").bind("click",function(){LPRequest.makeRequest(LPProxy.getNoteHistory,{parameters:[A.vaultItem.getID(),A.vaultItem.getShareID()],success:function(e){t(e,A.vaultItem,Constants.HISTORY_TYPES.NOTE)},requestSuccessOptions:{closeDialog:!1}})}),A.changePasswordButton.bind("click",function(){var t=function(){LPProxy.autoChangePassword(A.vaultItem.getID()),A.close(!0)};if(!A.vaultItem.canViewPassword())return void Topics.get(Topics.ERROR).publish(Strings.translateString("This is a shared site. You are not permitted to view the password."));A.isModified()?dialogs.confirmation.open({title:Strings.translateString("Auto Change Password"),text:Strings.translateString("Changes you have made have not been saved. Are you sure you want to continue?"),handler:t}):t()})}(this)};var t=function(A,t,e){dialogs.fieldHistory.open({history:A,vaultItem:t,type:e})};SiteDialog.prototype.open=function(A){if(A=$.extend(A,{sourceFunction:LPProxy.getSiteModel}),A.saveAllData){var t=A.saveAllData;delete A.saveAllData,A.defaultData={url:t.url,save_all:!0},e(t.formdata,A.defaultData)}else A.defaultData&&A.defaultData.formdata&&(e(A.defaultData.formdata,A.defaultData),delete A.defaultData.formdata);if(A.defaultData&&A.defaultData.url){var a=LPProxy.getDomain(A.defaultData.url),i=bg.get("siteCats");void 0===A.defaultData.group&&i[a]&&(bg.get("g_nofolder_feature_enabled")||(A.defaultData.group=i[a])),void 0===A.defaultData.name&&(A.defaultData.name=a)}if(A.saveOptions&&A.saveOptions.checkForReplacement){for(var a=LPProxy.getDomain(A.defaultData.url),o=[],n=LPProxy.getSiteModels(),s=0,l=n.length;s<l;++s){var r=n[s];LPProxy.getDomain(r.getURL())===a&&A.defaultData.unencryptedUsername===r.getUsername()&&o.push(r)}if(o.length>0)return void dialogs.vaultItemSelect.open({title:Strings.translateString("Replace Site"),nextButtonText:Strings.translateString("Replace"),backButtonText:Strings.Vault.NO,text:Strings.translateString("Would you like to replace an existing entry you have for %1?",a),items:o,closeHandler:this.createHandler(EditableFieldsDialog.prototype.open,A),handler:this.createDynamicHandler(function(t){var e=A.defaultData;delete A.defaultData,EditableFieldsDialog.prototype.open.call(this,$.extend(A,{vaultItem:t[0],postSetup:function(A){A.populateFields(e)}}))}),buildOptions:{multiSelect:!1}})}EditableFieldsDialog.prototype.open.call(this,A)},SiteDialog.prototype.setup=function(A,t){t.title=t.vaultItem?Strings.translateString("Edit Site"):Strings.translateString("Add Site"),EditableFieldsDialog.prototype.setup.call(this,A,t),this.changePasswordButton.hide(),this.vaultItem?(A.find(".history").show(),"1"===this.vaultItem._data.pwch&&this.changePasswordButton.show(),this.inputFields.url.disableDropdown()):(A.find(".history").hide(),this.inputFields.url.enableDropdown())},SiteDialog.prototype.validate=function(A){var t=EditableFieldsDialog.prototype.validate.apply(this,arguments);return""===A.name&&(this.addError("name","Name is required."),t=!1),t};var e=function(A,t){t.fields=[];for(var e=A.split("\n"),a=0,i=e.length;a<i;++a){var o=e[a].split("\t"),n=decodeURIComponent(o[0]),s=decodeURIComponent(o[1]),l=decodeURIComponent(o[2]),r=decodeURIComponent(o[3]);if("action"===r)t.action=l;else if("method"===r)t.method=l;else if(s)switch(r){case"email":case"text":case"url":case"tel":case"password":case"checkbox":case"radio":case"select":case"select-one":var u={formname:n,name:s,type:r,value:l};if("checkbox"===r)u.value="-1"===l.substring(l.length-2),u.valueAttribute=l.substring(0,l.length-2);else if("radio"===r){if("-1"!==l.substring(l.length-2))continue;u.value=l.substring(0,l.length-2)}t.fields.push(u)}}}}();