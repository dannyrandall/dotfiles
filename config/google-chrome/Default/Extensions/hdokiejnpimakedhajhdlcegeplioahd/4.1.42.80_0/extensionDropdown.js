ExtensionDropdown=function(e){var t=$(e.body),n=e.getElementById("items"),o=e.getElementById("searchResults"),i=e.getElementById("recentSites"),l=e.getElementById("identitiesMenuItem"),a=e.getElementById("matchingSitesTopLevel"),r=e.getElementById("matchingSites"),s=$("#groupLabel"),c=$("#backButton"),u=$("#debugconsole"),p=$("#encryptedExportMenuItem"),d=$("#wifiExportMenuItem"),g=$("#matchingSitesMenuItem"),m=$("#recentSitesMenuItem"),f=$("#container"),b=$("#searchInput"),v=$("#applicationsMenuItem"),P=null,h=null,I=null,L=null,y=null,T=null,S=null,_=null,E=!1,w=!1,C=!1,M=!1,x={},D=null,k={},A=[],N={},R=function(e){if(s.empty(),e){var t=e.getName();t=t.replace(/\\/g," \\ ");var n=t.indexOf("\\",t.length/2);if(n===-1&&(n=t.lastIndexOf("\\")),n>0){var o=LPTools.createElement("div","textOverflowContainer groupLabel");o.appendChild(LPTools.createElement("span",null,t.substring(0,n))),s.append(LPTools.createElement("span","textTail","Â "+t.substring(n))),s.append(o),LPTools.setupMiddleEllipsis(s)}else s.append(LPTools.createElement("span","groupLabel",t));s.find(".groupLabel").attr("title",e.toString())}};N.GroupState=function(e){var t=LPTools.getNavIndex();this.pop=function(){e.rebuildItems(),LPTools.setNavIndex(t),R(e._model)}},N.SearchState=function(){var e=new N.CSSState("searchItem",{restoreKeyboardNav:!1});this.pop=function(){q(),e.pop()}},N.TopLevelMatchingSitesState=function(e){var t=new N.CSSState("matchingSites"),n=new N.GroupState(e);this.pop=function(){n.pop(),t.pop()}},N.CSSState=function(){var e=t.attr("class"),n=function(n){t.removeClass(e),t.addClass(n),e=n};return function(t,o){var i=e;n(t),LPTools.getOption(o,"applyKeyboardNav",!0)&&LPTools.addKeyBoardNavigation($(".extensionMenuItem:visible"),{selectFirst:!0}),this.pop=function(){R(null),n(i),LPTools.getOption(o,"restoreKeyboardNav",!0)&&LPTools.addKeyBoardNavigation($(".extensionMenuItem:visible")),o&&"function"==typeof o.onPop&&o.onPop()}}}();var F=function(){LPTools.parseUserSpecificMenu(e.getElementById("mainMenu"),LPProxy.getAccountClass()),$("#username").text(bg.get("g_username")),O()},B=function(){f.addClass("loading"),V(),Y(),F(),f.addClass("initialized"),b.focus(),setTimeout(function(){K()},0)},O=function(){var e=function(){f.LP_removeAttr("style");var e=f.outerHeight();LPPlatform.setDropdownPopoverSize(e,f.outerWidth()),f.css("height",e),LPTools.addKeyBoardNavigation($(".extensionMenuItem:visible"))};return function(){0===A.length?e():A[0].pop=function(t){return function(){t(),e()}}(A[0].pop)}}(),H=function(){LPFeatures.updateFeatures({import:!0,noexport:!1,show_notes:!0,hideidentities:!1,show_formfills:!0})},K=function(){LPProxy.initializeModel(),U(),G(),w=!0,f.removeClass("loading");for(var e in k)k[e]();var t=b.val();t&&J(t),O()},z=function(e){var t;return LPProxy.getPreference("showAcctsInGroups",!0)&&(e=LPProxy.assignItemsToGroups(e,!1),t={separateFavorites:!0}),new Container(e,t)},G=function(){I=z(LPProxy.getSites()),I.setElement(n),L=z(LPProxy.getNotes()),L.setElement(n),y=new Container(LPProxy.getFormFills()),y.setElement(n),T=new Container(LPProxy.getApplications()),T.setElement(n),_=new Container(LPProxy.getAllItems(),{moreOptionsState:N.SearchState})},V=function(){u.LP_removeAttr("style"),p.LP_removeAttr("style"),d.LP_removeAttr("style"),v.LP_removeAttr("style"),bg.is_user_debug_enabled()&&u.show(),bg.have_binary()&&(p.show(),bg.LPPlatform.isWin()&&d.show()),LPTools.hasProperties(bg.get("g_applications"))&&v.show()},U=function(){if(h=LPProxy.getIdentities(),LPProxy.enableCurrentIdentity(h),h.length>0){Q(P);for(var t=[],n=0,o=h.length;n<o;++n)t.push(h[n].newDisplayObject());new IdentityContainer(t).initialize(e.getElementById("identities"))}else $(l).hide()},W=function(e){return x[e]===!0},j=function(e,t,n){for(var o=[],i=0,l=D.length;i<l;++i){var a=D[i].aid;o.push(new MatchingAccountDisplay(LPProxy.getSiteModel(a)))}var r=new Container(o,t);r.setElement(e),r.rebuildItems(),n&&O()},Y=function(){D=bg.getmatchingsites(!1,!0,!1);for(var t=0,n=D.length;t<n;++t)x[D[t].aid]=!0;var o=LPProxy.getPreference("toplevelmatchingsites",!1);o||0===D.length?(g.LP_removeAttr("style"),m.addClass("divider")):(g.show(),m.removeClass("divider")),o?X("topLevelMatchingSites",function(){j(a,{autoExpandSingleItem:!1,moreOptionsElement:e.getElementById("matchingSites"),moreOptionsState:N.TopLevelMatchingSitesState,addLastClass:!1},!0)})():D.length>0&&$("#matchingSiteCounter").text(D.length)},Z=function(){var e=bg.getClearRecentTime(),t=bg.Preferences.get("recentUsedCount"),n=I.getItemChildren().concat(L.getItemChildren());n.sort(VaultItemBaseDisplay.prototype.sortByMostRecent);for(var o=[],l=0,a=n.length;l<a&&l<t;++l){var r=n[l];r.getLastTouchValue()>=e&&o.push(r._model.newDisplayObject())}if(o.length>0){new Container(o,{sortFunction:VaultItemBaseDisplay.prototype.sortByMostRecent}).initialize(i)}else ae(i)},q=function(){LPTools.removeDOMChildren(o);for(var e=0,t=S.length;e<t;++e){var n=S[e],i=n.build();n.postBuild(i),o.appendChild(i)}if(0===S.length){var l=LPTools.buildEmptyPlaceholder(Strings.translateString("No Matching Results"),"extensionSearchPlaceholder",o);o.appendChild(l)}LPTools.addKeyBoardNavigation(o.children,{rightArrowSelector:".moreItem",selectFirst:!0})},J=function(){var e=null;return function(t){t.length>0?(w&&(S=_.getSearchResultItems(t),q()),E||(re("search",{applyKeyboardNav:!1,onPop:function(){b.val("")}}),E=!0)):e&&e.length>0&&(se(),E=!1),e=t}}(),Q=function(t){var n=Strings.translateString("Identities")+" ("+t.getName()+")",o=l.firstChild;3!==o.nodeType?(o=e.createTextNode(n),l.insertBefore(o,l.firstChild)):o.textContent=n},X=function(e,t){return function(){w?t():k[e]=t}},ee=function(e){e&&(e.stopPropagation(),e.preventDefault())},te=function(e){for(var t=null;null!==e&&null===(t=e.getAttribute("childview"));)e=e.parentElement;return t},ne=function(e){return e||(e={}),e.saveOptions={source:"icon"},e},oe=function(e){bg.LPPlatform.openTabDialog("site",ne(e))},ie=function(e){bg.LPPlatform.openTabDialog("note",ne(e))},le=function(e){bg.LPPlatform.openTabDialog("formFill",ne(e))},ae=function(e){e.appendChild(LPTools.createElement("li","extensionMenuItem none","None Available"))},re=function(e,t){A.push(new N.CSSState(e,t))},se=function(){var e=A.pop();e&&e.pop()},ce=function(){dialogs.generatePassword.getDialog().close(),c.unbind("click",ce)},ue=null,pe=function(){dialogs.generatePassword.open({preSetup:function(e){if(null===ue){var t=dialogs.generatePassword.parentElementID,n=e.options.hideHeader,o=e.dynamicHeight;ue=function(){dialogs.generatePassword.parentElementID=t,e.options.hideHeader=n,e.useDynamicHeignt(o)}}dialogs.generatePassword.parentElementID="extensionDropdownGeneratePassword",e.options.hideHeader=!0,e.useDynamicHeignt(!1)},onClose:function(){se()},onCopy:function(){LPPlatform.closePopup(!0)},saveOptions:{source:"icon"}}),c.unbind("click",ce),c.bind("click",ce)},de=function(e,t,n){if(e.isEmpty()){var o=LPTools.createElement("div","emptyView");o.appendChild(LPTools.createElement("img",{src:"images/vault_4.0/"+t,class:"emptyViewIcon"})),o.appendChild(LPTools.createElement("h1","emptyViewText",n)),document.getElementById("items").appendChild(o)}};b.LP_addSearchHandlers("inputDialog",function(e){J(e)}),c.bind("click",se),$("[childview]").bind("click",function(e){re(te(e.target)),ee(e)}),$("#addSite").bind("click",function(e){bg.get_selected_tab_data_no_extension(null,function(e){bg.lpevent("m_add"),oe({defaultData:{url:e?e.url:""}}),LPPlatform.closePopup()}),e.stopPropagation()}),$("#saveAllEnteredData").bind("click",function(){bg.lpevent("m_saed"),bg.saveall()}),$("#addNote").bind("click",function(){bg.lpevent("m_addn"),ie()}),$("#addFormFill").bind("click",function(){bg.lpevent("m_af"),le()}),$("#addCreditCard").bind("click",function(){bg.lpevent("m_af"),le({defaultData:{profiletype:FormFill.prototype.FORM_FILL_TYPE_CREDIT_CARD}})}),$("#clearForms").bind("click",function(){bg.lpevent("m_clrf"),bg.clearforms("icon")});var ge=null;$("#chooseProfile").bind("click",function(){dialogs.chooseProfile.open({preSetup:function(e){if(null===ge){var t=dialogs.chooseProfile.parentElementID,n=e.options.hideHeader;ge=function(){dialogs.chooseProfile.parentElementID=t,e.options.hideHeader=n,e.$element.css("min-height","")}}e.$element.css("min-height",0),dialogs.chooseProfile.parentElementID="chooseProfileCreditCard",e.options.hideHeader=!0},onClose:function(){se()},saveOptions:{source:"icon"}})}),$("#vaultMenuItem").bind("click",function(){bg.lpevent("m_ov"),bg.openvault()}),$("#sitesMenuItem").bind("click",function(){return X("sites",function(){I.rebuildItems(n),de(I,"Empty_Site.png",Strings.translateString("Remember every password"))})}()),$("#formFillsMenuItem").bind("click",function(){return X("formFills",function(){y.rebuildItems(n),de(y,"Empty_Form.png",Strings.translateString("Fill Every Form"))})}()),$("#applicationsMenuItem").bind("click",function(){return X("applications",function(){T.rebuildItems(n),de(T,"Empty_Site.png",Strings.translateString("Remember every password"))})}()),$("#generateMenuItem").bind("click",pe),$("#notesMenuItem").bind("click",function(){return X("notes",function(){L.rebuildItems(n),de(L,"Empty_Note.png",Strings.translateString("Store Every Note"))})}()),$("#clearMostRecent").bind("click",function(){bg.clearrecent(),LPTools.removeDOMChildren(i),ae(i)});var me=X("mostRecent",function(e){C||(Z(),C=!0),LPTools.addKeyBoardNavigation(i.children,{rightArrowSelector:".moreItem",selectFirst:!0})});m.bind("click",me);var fe=X("matchingSites",function(t){M||(j(r),M=!0),LPTools.addKeyBoardNavigation(e.getElementById("matchingSites").children,{rightArrowSelector:".moreItem",selectFirst:!0})});if(g.bind("click",fe),$("#prefMenuItem").bind("click",function(){bg.lpevent("m_op"),bg.openprefs()}),$("#helpMenuItem").bind("click",function(){bg.lpevent("m_oh"),bg.openhelp()}),$("#adminConsoleMenuItem").bind("click",function(){bg.lpevent("m_oec"),bg.openentconsole()}),$("#logoutMenuItem").bind("click",function(){bg.lpevent("m_lo"),bg.loggedOut(!1,"menu")}),$("#challengeMenuItem").bind("click",function(){bg.lpevent("m_sec"),bg.openseccheck()}),$("#favoritesMenuItem").bind("click",function(){bg.lpevent("m_of"),bg.openfavorites()}),$("#aboutMenuItem").bind("click",function(){bg.lpevent("m_abt"),bg.openabout()}),u.bind("click",function(){bg.lpevent("m_dbgcon"),bg.opendebugtab()}),$("#csvExportMenuItem").bind("click",function(){bg.lpevent("m_e"),bg.openexport()}),$("#formFillExportMenuItem").bind("click",function(){bg.lpevent("m_eff"),bg.formfillexport()}),p.bind("click",function(){bg.lpevent("m_elp"),bg.openlastpassexport()}),d.bind("click",function(){bg.lpevent("m_ewlan"),bg.wlanexport()}),$("#printSitesMenuItem").bind("click",function(){bg.lpevent("m_p"),bg.openprint(!1)}),$("#printNotesMenuItem").bind("click",function(){bg.lpevent("m_pn"),bg.openprint(!0)}),$("#refreshMenuItem").bind("click",function(){bg.lpevent("m_ref"),LPProxy.refreshSites()}),$("#clearCachMenuItem").bind("click",function(){bg.lpevent("m_cl"),bg.clearCache(!1,!0,!1)}),$("#myAccountMenuItem").bind("click",function(){bg.lpevent("m_mya"),bg.openmyaccount()}),$("#sessionsMenuItem").bind("click",function(){bg.lpevent("m_ses"),bg.opensessions()}),LPPlatform.addEventListener(window,"unload",function(){he()}),t.on("click",".extensionMenuItem, .footer",function(){LPPlatform.closePopup()}),LPFeatures.allowGift()){var be=$("#specialOfferMenuItem");be.show(),be.bind("click",function(){bg.openURL(LPProxy.getBaseURL()+"gift.php")})}Topics.get(Topics.PUSH_STATE).subscribe(function(e){A.push(e)}),Topics.get(Topics.EDIT_SITE).subscribe(function(e){e.vaultItem=e.vaultItem.getID(),oe(e)}),Topics.get(Topics.EDIT_NOTE).subscribe(function(e){e.vaultItem=e.vaultItem.getID(),ie(e)}),Topics.get(Topics.EDIT_FORM_FILL).subscribe(function(e){e.vaultItem=e.vaultItem.getID(),le(e)}),Topics.get(Topics.EDIT_APPLICATION).subscribe(function(e){e.vaultItem=e.vaultItem.getID(),bg.LPPlatform.openTabDialog("application",e)}),Topics.get(Topics.IDENTITY_ENABLE).subscribe(function(e){LPProxy.enableIdentity(e),P=e}),Topics.get(Topics.CONFIRM).subscribe(function(e){ve("confirmation",e)}),Topics.get(Topics.ERROR).subscribe(function(e){ve("alert",{title:Strings.Vault.ERROR,text:e})}),Topics.get(Topics.REPROMPT).subscribe(function(e){ve("reprompt",{successCallback:e})}),Topics.get(Topics.LEFT_ARROW).subscribe(function(){LPTools.disableMouse(),se()}),Topics.get(Topics.CLEAR_DATA).subscribe(function(){for(var e=A.length-1;e>-1;--e)A[e].pop();A=[],LPTools.setNavIndex(0),b.val(""),E=!1,w=!1,C=!1,M=!1,x={},k={},D=null,ue&&ue(),ge&&ge(),f.removeClass("initialized"),Dialog.prototype.closeAllDialogs(!0)}),Topics.get(Topics.INITIALIZED).subscribe(function(){Strings.translate(e.body),H(),LPPlatform.setupDropdownImportMenu(f)});var ve=function(e,t){$("#container").LP_hide(),LPTools.removeKeyBoardNavigation(),t=$.extend(t,{onResize:function(e,t){LPPlatform.setDropdownPopoverSize(e,t)},onClose:function(){LPPlatform.closePopup()}}),LPDialog.openDialog(e,t)},Pe=function(){var e=bg.get("g_badgedata");if(e&&"notification"===e.cmd){switch(e.alerttype){case"duplicate":ve("duplicatePassword",{notification:e});break;case"weak":ve("weakPassword",{notification:e})}switch(e.type){case"error":ve("notification",{notification:bg.get("g_notification_data")})}bg.clear_badge()}else $("#container").LP_show(),B()},he=function(){Topics.get(Topics.CLEAR_DATA).publish()};return{setup:B,State:N,isMatchingSite:W,setGroupLabel:R,open:Pe,openDialog:ve,reset:he,setBigIcons:function(e){bg.set("g_bigicons",e)}}}(document);