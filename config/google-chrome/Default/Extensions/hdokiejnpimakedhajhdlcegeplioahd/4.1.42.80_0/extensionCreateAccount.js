var ExtensionCreateAccount=function(e,t){t||(t={}),Dialog.call(this,e,Object.assign(t,{dynamicHeight:!1,responsive:!1,buttonAlign:this.CENTER_ALIGN,largeButtons:!0,buttonsInsideContent:!0,title:Strings.translateString("Create Account"),hideHeaderTitle:!0,hideBackButton:!0}))};ExtensionCreateAccount.prototype=Object.create(CreateAccountDialog.prototype),ExtensionCreateAccount.prototype.constructor=ExtensionCreateAccount,function(){function e(){c.inputFields.email.onChange(function(e){e&&n(e,function(e){c.inputFields.email.validate({response:e})})})}function t(){c.inputFields.password.onChange(function(e){e&&c.inputFields.password.validate({password:c.inputFields.password.getValue(),email:c.inputFields.email.getValue()})}),c.inputFields.password.getElement().keyup(function(e){c.inputFields.password.validate({password:c.inputFields.password.getValue(),email:c.inputFields.email.getValue()},!0)})}function i(){c.inputFields.reconfirm.onChange(function(e){e&&c.inputFields.reconfirm.validate({reconfirm:c.inputFields.reconfirm.getValue(),password:c.inputFields.password.getValue()})})}function r(){c.inputFields.reminder.onChange(function(e){e&&c.inputFields.reminder.validate({reminder:c.inputFields.reminder.getValue(),password:c.inputFields.password.getValue()})})}function n(e,t){bg.LPServer.textRequest({type:"GET",url:"create_account.php",CSRFToken:!1,data:{username:e,check:"avail",mistype:1},success:t,error:t})}function a(e,t){return function(i,r){var n=!1;return t&&(c.clearError(e),n=t.validate(i,function(t){c.addError(e,t)},r)),n}}function o(){if(!c.inputFields.email.fieldValidator){var e=LPTools.createElement("a",{class:"pull-right recovery-link",href:"https://lastpass.com/forgot.php",target:"_blank"},Strings.translateString("Recovery Help")),t=LPTools.createElement("p",null,Strings.translateString("Email address already in use "));t.appendChild(e);var i=new FieldValidator({summary:{id:"validatorSummaryEmail",parentEl:$("label[for='createAccountEmail'].error-summary"),labelEl:$("label[for='createAccountEmail'].validator-label")},validators:[{id:"403",errorMsg:LPTools.createElement("p",null,Strings.translateString("You've made too many attempts, wait 5 minutes and try again.")),isValid:function(e){return!(e.response.status&&403===e.response.status)}},{id:"emailUsed",errorMsg:t,isValid:function(e){return"no"!==e.response}},{id:"emailInvalid",errorMsg:LPTools.createElement("p",null,Strings.translateString("Make sure to use a real email address")),isValid:function(e){return"ok"===e.response&&0!==e.response.indexOf("mistype:")&&"emailinvalid"!==e.response}}]});c.inputFields.email.validate=a("email",i),c.inputFields.email.fieldValidator=i}}function s(){if(!c.inputFields.termsAndConditions.fieldValidator){var e=new FieldValidator({summary:{id:"validatorSummaryTermsAndConditions",parentEl:$("label[for='termsAndConditions'].error-summary"),labelEl:$("label[for='createAccountEmail'].validator-label")},validators:[{id:"termsNotChecked",errorMsg:LPTools.createElement("p",null,Strings.translateString("Please agree to the Terms and Conditions")),isValid:function(e){return e.termsAndConditions===!0}}]});c.inputFields.termsAndConditions.validate=a("termsAndConditions",e),c.inputFields.termsAndConditions.fieldValidator=e}}function l(){if(!c.inputFields.password.fieldValidator){var e=new FieldValidator({summary:{id:"validatorSummaryPassword",parentEl:$("label[for='createAccountDialogPassword'].error-summary"),labelEl:$("label[for='createAccountDialogPassword'].validator-label"),errorMsg:LPTools.createElement("p",null,Strings.translateString("Sorry, your password is invalid"))},listParentEl:$("#mpValidators"),isPopup:c.data.isPopup,validators:[{id:"passwordLength",name:LPTools.createElement("p",null,Strings.translateString("At least 8 characters long")),errorMsg:LPTools.createElement("p",null,Strings.translateString("Master password must be at least 8 characters")),isValid:function(e){return(e.password&&e.password.length>=8)===!0}},{id:"passwordSameAsEmail",name:LPTools.createElement("p",null,Strings.translateString("Not your email")),errorMsg:LPTools.createElement("p",null,Strings.translateString("Master password shouldn‘t contain your email")),isValid:function(e){return(e.password&&e.email&&e.password.toLowerCase().indexOf(e.email.toLowerCase())===-1&&e.email.toLowerCase().indexOf(e.password.toLowerCase())===-1)===!0}},{id:"easyPassword",name:LPTools.createElement("p",null,Strings.translateString("Not easily guessable")),errorMsg:LPTools.createElement("p",null,Strings.translateString("That‘s in the top 100 most-used passwords")),isValid:function(e){return(e.password&&!e.password.match(/^password\d{0,3}$/i)&&!e.password.match(/^lastpass\d{0,3}$/i)&&!e.password.match(/^.{0,7}$/)&&"12345678"!==e.password&&"123456789"!==e.password&&"1234567890"!==e.password&&"lastpass.com"!==e.password&&"qwertyuiop"!==e.password&&"abcd1234"!==e.password)===!0}}]});c.inputFields.password.validate=a("password",e),c.inputFields.password.fieldValidator=e}}function d(){if(!c.inputFields.reconfirm.fieldValidator){$("#twinsies").hide();var e=new FieldValidator({summary:{id:"validatorSummaryReconfirm",parentEl:$("label[for='createAccountDialogConfirmPassword'].error-summary"),labelEl:$("label[for='createAccountDialogConfirmPassword'].validator-label, #twinsies")},validators:[{id:"reconfirmSameAsPassword",name:LPTools.createElement("p",null,Strings.translateString("Reconfirm same as password")),errorMsg:LPTools.createElement("p",null,Strings.translateString("Make sure this matches your master password")),isValid:function(e){return(e.reconfirm&&e.password===e.reconfirm)===!0}}]});c.inputFields.reconfirm.validate=a("reconfirm",e),c.inputFields.reconfirm.fieldValidator=e}}function u(){if(!c.inputFields.reminder.fieldValidator){var e=new FieldValidator({summary:{id:"validatorSummaryReminder",parentEl:$("label[for='createAccountReminder'].error-summary"),labelEl:$("label[for='createAccountReminder'].validator-label")},validators:[{id:"reminderNotPassword",name:LPTools.createElement("p",null,Strings.translateString("Reminder doesn‘t contain password")),errorMsg:LPTools.createElement("p",null,Strings.translateString("Reminder can‘t contain your master password")),isValid:function(e){return!(e.password&&e.reminder.toLowerCase().indexOf(e.password.toLowerCase())!==-1)}}]});c.inputFields.reminder.validate=a("reminder",e),c.inputFields.reminder.fieldValidator=e}}function p(){var e=[];for(var t in c.inputFields)c.inputFields.hasOwnProperty(t)&&c.inputFields[t].fieldValidator&&(e=e.concat(c.inputFields[t].fieldValidator.getValidationList()));return e}var c,m,g,f;ExtensionCreateAccount.prototype.initialize=function(n){CreateAccountDialog.prototype.initialize.apply(this,arguments),$(".meterContainer").remove(),this.inputFields.password.getElement().LP_addPasswordMeter(this.inputFields.email.getElement(),!this.data.isPopup),c=this,function(a){var l=n.find(".buttonContent"),d=n.find(".buttons").detach();if(l.append(d),a.data.isPopup){var u=(new FieldToolTip({parentEl:n,isPopup:a.data.isPopup,arrow:new lpArrow({$parentEl:$("#helpContainer")})}),n.find("#mpEntry .buttons.centerButtons")),p=LPTools.createElement("button","nbtn wbtn",Strings.translateString("Back"));u.prepend(p),p=n.find("#mpEntry .nbtn.wbtn"),p.bind("click",function(e){c.showPreviousView()}),f="2.0"}else{new FieldToolTip({parentEl:n,isPopup:a.data.isPopup});g=new EmailToolTip({toolTipEl:n.find("#mpCurrentEmail"),parentEl:$("body"),emailField:c.inputFields.email,backActionFn:function(){c.showPreviousView()}}),$("body").addClass("login-background"),f="1.0"}n.find("#signInBtn").bind("click",function(e){e.preventDefault(),bg.sendLpImprove("viewloginform"),a.data.isPopup?ExtensionDropdown.openDialog("loginTab"):dialogs.loginSimple.open({isPopup:!1}),a.close(!0)}),o(),s(),e(),t(),i(),r(),m=new BackgroundOverlay({parentEl:$("body")}),c.setDynamicHeight()}(this)},ExtensionCreateAccount.prototype.setNextView=function(e){Dialog.prototype.setNextView.apply(this,arguments),g&&g.toggle(e>0);var t={currentPage:0===this.currentViewIndex?"email":"mpw",version:f};bg.sendLpImprove("viewregform",t)},ExtensionCreateAccount.prototype.close=function(e){e?Dialog.prototype.close.apply(this,arguments):function(e){LPTools.getOption(e.data,"showcloseconfirm",!0)?(m.show(),dialogs.confirmation.open({title:"LastPass",text:Strings.translateString("Do you really want to quit?  You cannot use LastPass without creating an account."),closeHandler:function(){m.hide()},handler:function(){e.close(!0)}})):e.close(!0)}(this)},ExtensionCreateAccount.prototype.clearError=function(e){var t=this.inputFields[e];t&&t.clearErrors()},ExtensionCreateAccount.prototype.addError=function(e,t){var i=this.inputFields[e];i&&(i._errors.push(t),i.clearErrors=function(){this._errors=[],i._errorElement&&i._errorElement.remove(),this._errorElement=null})},ExtensionCreateAccount.prototype.validate=function(e,t){if(0===this.currentViewIndex)n(e.email,function(i){var r=c.inputFields.email.validate({response:i});r&&(r&=c.inputFields.termsAndConditions.validate(e)),t&&t(r)});else if(this.currentViewIndex===this.views.length-1){var i=c.inputFields.password.validate(e);i&=c.inputFields.reconfirm.validate(e),i&=c.inputFields.reminder.validate(e),t&&t(i)}},ExtensionCreateAccount.prototype.submit=function(){try{var e=this.getData();this.validate(e,function(t){if(t)c.getNextViewButton()===c.nextButton&&c.views&&c.currentViewIndex<c.views.length-1?(l(),d(),u(),c.setNextView(c.currentViewIndex+1),c.setDynamicHeight()):(bg.sendLpImprove("completedregform",{version:f}),c.handleSubmit(e,this.data),c.data.isPopup&&c.close(!0));else{var i=p().join(","),r={errorlist:i,version:f};c.inputFields.reminder&&""!==c.inputFields.reminder.getValue()&&(r.isReminder=!0),i.length>0&&(r.currentPage=0===c.currentViewIndex?"email":"mpw",bg.sendLpImprove("validationregform",r))}})}catch(e){LPPlatform.logException(e)}},ExtensionCreateAccount.prototype.showInProcessOverlay=function(){m.show(!0)}}();